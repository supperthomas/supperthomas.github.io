<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8. RT-Thread 软件包制作及发布流程 &mdash; bluetoothlover_wiki 0.0.1 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="WB55:dozingfiretruck" href="../../04_dozingfiretruck/index.html" />
    <link rel="prev" title="7. stm32wb55 基于rtt的ble sample制作过程" href="../07_stm32wb55_ble_ibeacon/stm32wb55_ble_ibeacon.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> bluetoothlover_wiki
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">BLE knowledge:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ble/index.html">BLE STACK篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ble_profile/index.html">BLE PROFILE篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nordic/index.html">Nordic 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WB55/index.html">STM32WB55 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WIKI_FAQ/index.html">WIKI FAQ 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RTTHREAD/index.html">RTTHRED: RT-Thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../12_ESP32/index.html">ESP32</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DEBUG/index.html">EMBEDDED DEBUG 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_supperthomas/index.html">MASTER:supperthomas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_helloworldzlg/index.html">WB55:helloworldzlg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_Jackistang/index.html">WB55:Jackistang</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">WB55:xupenghu</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01_introduce/01_intruduce.html">1. 简单自我介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_introduce/STM32WB%E7%A1%AC%E4%BB%B6%E4%BB%8B%E7%BB%8D.html">2. STM32WB 硬件介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_nrf_sniffer/nrf_ble_sniffer.html">3. 使用NRF52xx sniffer抓取BLE包</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_btsnoop_hci/android_hci.html">4. 使用Android手机抓取蓝牙HCI包</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_art-pi_ble_netin/art-pi_net_connect_with_ble.html">5. ART-PI开发板蓝牙配网流程分析</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06_stm32wb55_ble_start/stm32wb55_ble_start.html">6. STM32WB55 蓝牙协议栈运行流程解析</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_stm32wb55_ble_ibeacon/stm32wb55_ble_ibeacon.html">7. stm32wb55 基于rtt的ble sample制作过程</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">8. RT-Thread 软件包制作及发布流程</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">8.1. 前言</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">必备知识</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id3">8.2. 制作流程</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">为什么你做好的软件包能被其他开发者使用</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">如何制作一个软件包并提交</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id12">8.3. 总结</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faq">8.4. FAQ</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#menuconfigconfig">如何在menuconfig隐藏一些config</a></li>
<li class="toctree-l4"><a class="reference internal" href="#depends-on-select">depends on 和select语句的区别</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../04_dozingfiretruck/index.html">WB55:dozingfiretruck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05_luhuadong/index.html">WB55:luhuadong</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_answerinthewind/index.html">WB55:answerinthewind</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06_chenyingchun0312/index.html">NORDIC:chenyingchun0312</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../07_ylz0923/index.html">NORDIC:ylz0923</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../08_guohp1128/index.html">NORDIC:guohp1128</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10_jiy/index.html">NORDIC:jiy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../11_ForestRain/index.html">NORDIC:ForestRain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../13_xiangxistu/index.html">NORDIC:xiangxistu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../14_bobwenstudy/index.html">NORDIC:bobwenstudy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../16_ColeStudy/index.html">NORDIC:ColeStudy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">bluetoothlover_wiki</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">WB55:xupenghu</a></li>
      <li class="breadcrumb-item active"><span class="section-number">8. </span>RT-Thread 软件包制作及发布流程</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/03_xupenghu/08_rt-thread_packages/08_rt-thread_packages.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="rt-thread">
<h1><span class="section-number">8. </span>RT-Thread 软件包制作及发布流程<a class="headerlink" href="#rt-thread" title="此标题的永久链接"></a></h1>
<section id="id1">
<h2><span class="section-number">8.1. </span>前言<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h2>
<p>RT-Thread是一个嵌入式实时多线程操作系统，系统完全开源，它不仅仅是一个实时内核，还具备丰富的中间层组件，包括如文件系统、图形库等较为完整的中间件组件，具备低功耗、安全、通信协议支持和云端连接能力的软件平台。</p>
<p>我们可以结合rtthread提供的组件和服务，制作软件包，丰富rt-thread的软件生态。让更多的开发者做到开箱即用，不用重复造轮子。</p>
<section id="id2">
<h3>必备知识<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h3>
<ul class="simple">
<li><p>熟悉<a class="reference external" href="https://github.com/RT-Thread/rt-thread">rt-thread</a></p></li>
<li><p>了解<a class="reference external" href="https://docs.rt-thread.org/#/development-tools/kconfig/kconfig">Kconfig</a></p></li>
<li><p>了解<a class="reference external" href="https://docs.rt-thread.org/#/development-tools/env/env">Env</a>开发工具</p></li>
<li><p>了解<a class="reference external" href="https://docs.rt-thread.org/#/development-tools/scons/scons">Scons</a>构建工具</p></li>
</ul>
</section>
</section>
<section id="id3">
<h2><span class="section-number">8.2. </span>制作流程<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h2>
<section id="id4">
<h3>为什么你做好的软件包能被其他开发者使用<a class="headerlink" href="#id4" title="此标题的永久链接"></a></h3>
<p>首先需要明确的是，rt-thread的软件包分为两个部分</p>
<ul class="simple">
<li><p>软件包</p></li>
<li><p>包信息</p></li>
</ul>
<p>其中，软件包里存放的是具体的代码源文件，包信息里面存放的是这个软件包的基本信息，不包括源代码文件。</p>
<p>通过Env的menuconfig在某个BSP或者工程下面配置工程的时候，我们选择online package的时候，就会列举出当前已经基于rt-thread实现的软件包。如下图所示：</p>
<p><img alt="../../_images/011.png" src="../../_images/011.png" /></p>
<p>那么，这些软件包，在本地是存储在那里的呢？</p>
<p>打开Env的安装目录，然后定位到 packages-&gt;packages 文件夹下</p>
<p><img alt="../../_images/021.png" src="../../_images/021.png" /></p>
<p>这是一个git仓库，这里面就存放了所有rt-thread已经做好的软件包的<em>包信息</em>，我们通过menuconfig选择的软件包其实最终都链接到了这里，所以你在env里面使用</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">pkgs</span><span class="w"> </span><span class="o">--</span><span class="n">upgrade</span><span class="w"></span>
</pre></div>
</div>
<p>env就会从GitHub的仓库更新当前最新的软件包<em>包信息</em>到本地。所以当开发者制作好了一个软件包后提交到GitHub对应的软件包仓库，然后你在本地再upgrade一下就同步了。<strong>这样子只要有开发者提交软件包，你的menuconfig里能看到软件包就会越来越多。</strong></p>
<p>所以，软件包的制作者在制作完成一个软件包后，必须要像rt-thread管理的<a class="reference external" href="https://github.com/RT-Thread/packages">软件包包信息仓库</a>提交自己做好的软件包包信息，这一点非常重要。</p>
</section>
<section id="id5">
<h3>如何制作一个软件包并提交<a class="headerlink" href="#id5" title="此标题的永久链接"></a></h3>
<p>首先需要明确的是，你做好的软件包是可以放到自己的GitHub仓库的，同样也可以托管到rt-thread的<a class="reference external" href="https://github.com/rt-thread-packages">GitHub软件包仓库</a>。如果觉得每次向rt-thread软件包仓库提交代码需要审核比较麻烦的话，建议将软件包仓库放到自己GitHub。但是软件包代码更新了以后记得要在包信息仓库更新包信息，以便于开发者使用最新的软件包。</p>
<p>我们以一个简单的传感器软件包为例，来说一下制作一个软件包的具体流程。</p>
<section id="id6">
<h4>软件包仓库的制作<a class="headerlink" href="#id6" title="此标题的永久链接"></a></h4>
<p>前面讲过，一个软件分为包信息和软件包两个部分。首先我们讲一下软件包的制作。</p>
<ol class="simple">
<li><p>确保这个传感器的驱动已经接入rt-thread的sensor框架，并且代码能够在rt-thread上正常运行。
<img alt="../../_images/031.png" src="../../_images/031.png" />
比如一开始调试这个传感器的时候，我为了调试方便，就将传感器的所有源代码文件都放在了app文件夹内。这一步要做到传感器正常工作且接入了sensor框架。</p></li>
<li><p>将这个传感器的源代码文件都放入一个文件夹
<img alt="../../_images/041.png" src="../../_images/041.png" /></p></li>
<li><p>增加一个SConscript文件和一个readme文件。SConscript文件内容请查看rt-thread的官方文档。readme就是一个说明文档，告诉其他人你这个软件的信息以及别人如何上手，写的越详细越好，降低使用门槛。
<img alt="../../_images/051.png" src="../../_images/051.png" /></p></li>
</ol>
</section>
<section id="id7">
<h4>包信息的制作<a class="headerlink" href="#id7" title="此标题的永久链接"></a></h4>
<ol class="simple">
<li><p>在我们之前提到的env安装目录的package文件夹内的对应位置新建一个传感器包信息的文件夹。我们之前说过，menuconfig里面的软包信息就是这里的内容的呈现，我们需要在本地调试ok以后才能将软件包推送到GitHub仓库供其他人使用。
<img alt="../../_images/061.png" src="../../_images/061.png" /></p></li>
<li><p>在文件夹里面新建两个文件，一个Kconfig文件，一个package.json文件，这两个文件的内容和作用，请查看<a class="reference external" href="https://docs.rt-thread.org/#/rt-thread-version/rt-thread-standard/development-guide/package/package?id=%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97">rt-thread的官方文档</a>，我们这里默认你已经知道这两个文件的作用了。
<img alt="../../_images/071.png" src="../../_images/071.png" /></p></li>
<li><p>sensor目录下的Kconfig文件内增加一条记录，用来索引刚添加的软件包。</p></li>
</ol>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">source</span><span class="w"> </span><span class="s">&quot;$PKGS_DIR/packages/peripherals/sensors/ina260/Kconfig&quot;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id8">
<h4>调试<a class="headerlink" href="#id8" title="此标题的永久链接"></a></h4>
<p>经过以上两个步骤，你就可以在本地调试你的软件包了，如果调试没有问题，那就可以发布到GitHub了。</p>
<ol class="simple">
<li><p>我们随便找一个支持rt-thread的开发板，创建一个基本的rt-thread工程。然后将上一步做好的软件包仓库放到该工程的package文件夹。
注：如果你的工程目录里面没有packages文件夹，那你可以在manuconfig里面随便选一个软件包，然后再去掉，再使用<code class="docutils literal notranslate"><span class="pre">scons</span> <span class="pre">--target==mdk5</span></code>重新生成工程，这样子工程目录里面就有packages文件夹了，注意：<strong>packages文件夹里的这些文件不要删除，这个是组织工程的必要文件。</strong></p></li>
<li><p>env命令工具行定位到该工程，然后menuconfig进入软件包选择，因为上一步我们已经加入了包信息，所以就可以索引到我们刚添加的软件包了，然后选中它，保存退出。
<img alt="../../_images/081.png" src="../../_images/081.png" /></p></li>
<li><p>使用<code class="docutils literal notranslate"><span class="pre">scons</span> <span class="pre">--target==mdk5</span></code> 更新工程，然后用keil打开工程，编译下载，如果没有问题则调试🆗，有问题则需要修改我们添加的Sconscript文件里面的内容了，修改方法见<a class="reference external" href="https://docs.rt-thread.org/#/development-tools/scons/scons?id=%E4%BD%BF%E7%94%A8-scons-%E7%AE%A1%E7%90%86%E5%B7%A5%E7%A8%8B">官方文档</a>。</p></li>
</ol>
</section>
<section id="id9">
<h4>发布<a class="headerlink" href="#id9" title="此标题的永久链接"></a></h4>
<p>至此，本地调试OK，我们需要发布软件包以便于让所有的开发者都使用。同样的，我们需要发布包信息和软件包。</p>
<section id="id10">
<h5>发布软件包<a class="headerlink" href="#id10" title="此标题的永久链接"></a></h5>
<p>GitHub上新开一个repo，将我们在packages文件夹里的软件包pull到这个新的repo中。
<img alt="../../_images/091.png" src="../../_images/091.png" />
然后发布一个release版本，因为包信息里面需要填写。</p>
</section>
</section>
<section id="id11">
<h4>发布包信息<a class="headerlink" href="#id11" title="此标题的永久链接"></a></h4>
<p>还记得我们之前在包信息里面创建了一个package.json文件夹吗，在这里面填写刚才发布的软件包信息，然后将这个包信息pr到rt-thread官方维护的包信息仓库。具体贡献流程见<a class="reference external" href="https://docs.rt-thread.org/#/rt-thread-version/rt-thread-standard/development-guide/github/github">官方文档</a>。</p>
</section>
</section>
</section>
<section id="id12">
<h2><span class="section-number">8.3. </span>总结<a class="headerlink" href="#id12" title="此标题的永久链接"></a></h2>
<ul class="simple">
<li><p>其实贡献软件包的流程和使用软件包刚好是相反的，贡献的准则是在本地调试OK后再发布到GitHub仓库。</p></li>
<li><p>调试的时候不能使用 <code class="docutils literal notranslate"><span class="pre">pkgs</span> <span class="pre">--upgrade</span></code> 命令，因为这条命令会更新packages仓库，会把我们自己修改的内容给刷掉。</p></li>
<li><p>调试的时候也不能使用<code class="docutils literal notranslate"><span class="pre">pkgs</span> <span class="pre">--update</span></code>命令，这条命令的含义是下载网络软件包到本地，应为我们现在就是在本地调试阶段，网络上根本就没有这个软件包。</p></li>
<li><p>使用<code class="docutils literal notranslate"><span class="pre">scons</span> <span class="pre">--target==mdk5/iar</span></code> 命令只是构建了这个工程，并没有编译该工程，建议多看看scons 。这个对构建工程很有帮助，尤其是工程比较复杂的时候，用scons构建会方便快捷很多，而且也便于管理。</p></li>
</ul>
</section>
<section id="faq">
<h2><span class="section-number">8.4. </span>FAQ<a class="headerlink" href="#faq" title="此标题的永久链接"></a></h2>
<section id="menuconfigconfig">
<h3>如何在menuconfig隐藏一些config<a class="headerlink" href="#menuconfigconfig" title="此标题的永久链接"></a></h3>
<p>Kconfig中有个特殊的用法，在制作大型软件包的时候会遇到，就是有一些宏定义是不愿意让客户在menuconfig中进行修改的，但是又是相关开源软件包中必须要包含的，而且数目也比较众多的，对Kconfig一些选项有一些依赖的，也就是不希望该配置选项出现在menuconfig中。</p>
<p>下面以Kconfig举例说明：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="n">BSP_USING_GPIO</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="s">&quot;Enable GPIO&quot;</span><span class="w"></span>
<span class="w">    </span><span class="k">default</span><span class="w"> </span><span class="n">y</span><span class="w"></span>
</pre></div>
</div>
<p>将上述语句中的<code class="docutils literal notranslate"><span class="pre">bool</span></code>后面的注释去掉。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="n">BSP_USING_GPIO</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span>
<span class="w">    </span><span class="k">default</span><span class="w"> </span><span class="n">y</span><span class="w"></span>
</pre></div>
</div>
<p>这个时候在menuconfig中就不会出现该宏定义，但是宏定义还是会有</p>
</section>
<section id="depends-on-select">
<h3>depends on 和select语句的区别<a class="headerlink" href="#depends-on-select" title="此标题的永久链接"></a></h3>
<p>例如，如下配置</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="w"> </span><span class="n">BSP_USING_UART3</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="s">&quot;UART3 config&quot;</span><span class="w"></span>
<span class="w">    </span><span class="k">default</span><span class="w"> </span><span class="n">y</span><span class="w"></span>
<span class="w">    </span><span class="n">depends</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">BSP_USING_UART</span><span class="w"></span>
<span class="w">    </span><span class="n">select</span><span class="w"> </span><span class="n">RT_USING_SERIAL</span><span class="w"></span>
</pre></div>
</div>
<p>这个其中的含义是：BSP_USING_UART3是否需要呈现给客户配置和选中，依赖于BSP_USING_UART这个配置是否打开。 一旦BSP_USING_UART3选中了，RT_USING_SERIAL这个也必须要选中。</p>
<p>depends和select都需要注意的是：depends和select后面的宏定义必须要在其他地方有对应的config或者选项声明，否则不会生效。</p>
<p>可以这样理解他们之间的区别：</p>
<ul class="simple">
<li><p>select 相当于这个配置需要的一些组件配置选项</p></li>
<li><p>depends on 相当于这个配置需要哪些配置打开才会显示，这个通常和if/endif 形式类似。</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="../07_stm32wb55_ble_ibeacon/stm32wb55_ble_ibeacon.html" class="btn btn-neutral float-left" title="7. stm32wb55 基于rtt的ble sample制作过程" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../../04_dozingfiretruck/index.html" class="btn btn-neutral float-right" title="WB55:dozingfiretruck" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2020, apache.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>