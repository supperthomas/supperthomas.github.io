<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3. 从零到一搭建Kconfig配置系统 &mdash; bluetoothlover_wiki 0.0.1 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="NORDIC:ColeStudy" href="../../16_ColeStudy/index.html" />
    <link rel="prev" title="2. 使用Eclipse CDT build tools之后导致makefile环境错乱的问题" href="02_makefile_shell_env.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> bluetoothlover_wiki
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">BLE knowledge:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ble/index.html">BLE STACK篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ble_profile/index.html">BLE PROFILE篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nordic/index.html">Nordic 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WB55/index.html">STM32WB55 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WIKI_FAQ/index.html">WIKI FAQ 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RTTHREAD/index.html">RTTHRED: RT-Thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../12_ESP32/index.html">ESP32</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DEBUG/index.html">EMBEDDED DEBUG 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_supperthomas/index.html">MASTER:supperthomas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_helloworldzlg/index.html">WB55:helloworldzlg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_Jackistang/index.html">WB55:Jackistang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_xupenghu/index.html">WB55:xupenghu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_dozingfiretruck/index.html">WB55:dozingfiretruck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05_luhuadong/index.html">WB55:luhuadong</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_answerinthewind/index.html">WB55:answerinthewind</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06_chenyingchun0312/index.html">NORDIC:chenyingchun0312</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../07_ylz0923/index.html">NORDIC:ylz0923</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../08_guohp1128/index.html">NORDIC:guohp1128</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10_jiy/index.html">NORDIC:jiy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../11_ForestRain/index.html">NORDIC:ForestRain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../13_xiangxistu/index.html">NORDIC:xiangxistu</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">NORDIC:bobwenstudy</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01_introduce/index.html">01_introduce</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_zephyr_polling/index.html">02_zephyr_polling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_bluetooth/index.html">03_bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_markdown/index.html">04_markdown</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">05_compile</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_scons_introduce_and_common_templates_for_embedded_development.html">1. Scons环境搭建和编译原理概述及嵌入式开发常用模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="02_makefile_shell_env.html">2. 使用Eclipse CDT build tools之后导致makefile环境错乱的问题</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">3. 从零到一搭建Kconfig配置系统</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">3.1. 背景说明</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">3.2. 环境搭建</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">3.3. Kconfig基本概念&amp;语法</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">3.4. Kconfig实战</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../16_ColeStudy/index.html">NORDIC:ColeStudy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">bluetoothlover_wiki</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">NORDIC:bobwenstudy</a></li>
          <li class="breadcrumb-item"><a href="index.html">05_compile</a></li>
      <li class="breadcrumb-item active"><span class="section-number">3. </span>从零到一搭建Kconfig配置系统</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/14_bobwenstudy/05_compile/03_kconfig_system.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="kconfig">
<h1><span class="section-number">3. </span>从零到一搭建Kconfig配置系统<a class="headerlink" href="#kconfig" title="此标题的永久链接"></a></h1>
<section id="id1">
<h2><span class="section-number">3.1. </span>背景说明<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h2>
<p>最早接触到<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>是在<code class="docutils literal notranslate"><span class="pre">zephyr</span></code>项目中，之后陆续知道<code class="docutils literal notranslate"><span class="pre">linux</span></code>和<code class="docutils literal notranslate"><span class="pre">RT-Thread</span></code>等项目都是用<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>来管理编译的，而自己也陆续有大型项目开发需要，了解过后对其使用愈发感兴趣起来。</p>
<p>在实际项目开发中，通常会有需要去使能/关闭一些代码模块或者修改一些配置参数。</p>
<p>项目代码都放在GitHub上，<a class="reference external" href="https://github.com/bobwenstudy/test_kconfig_system">bobwenstudy/test_kconfig_system (github.com)</a></p>
<section id="id2">
<h3>代码管理<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h3>
<p>使能或者关闭代码，可以通过<code class="docutils literal notranslate"><span class="pre">#define+#ifdef</span></code>就可以实现这一目的。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CONFIG_TEST_ENABLE</span>

<span class="cp">#ifdef CONFIG_TEST_ENABLE</span>
<span class="w">	</span><span class="p">...</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">...</span><span class="w"></span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>调整配置参数，直接通过<code class="docutils literal notranslate"><span class="pre">#define</span></code>就可以实现这一目的。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CONFIG_TEST_SHOW_STRING &quot;Test 123&quot;</span>
<span class="cp">#define CONFIG_TEST_SHOW_INT (123)</span>
</pre></div>
</div>
<p>但是通过这个方式有个问题，就是不直观，如果就几个参数还好，但是当参数越来越多，并之前存在先后关系时，管理难度会呈指数上升。</p>
<p>如下面的例子，<code class="docutils literal notranslate"><span class="pre">CONFIG_TEST_SUB_1_ENABLE</span></code>的开启前提是<code class="docutils literal notranslate"><span class="pre">CONFIG_TEST_TOP_ENABLE</span></code>开启，当<code class="docutils literal notranslate"><span class="pre">CONFIG_TEST_SUB_0_ENABLE</span></code>和<code class="docutils literal notranslate"><span class="pre">CONFIG_TEST_SUB_1_ENABLE</span></code>都开启的情况下<code class="docutils literal notranslate"><span class="pre">CONFIG_TEST_SHOW_INT</span> <span class="pre">=</span> <span class="pre">123</span></code>，否则<code class="docutils literal notranslate"><span class="pre">CONFIG_TEST_SHOW_INT</span> <span class="pre">=</span> <span class="pre">456</span></code>。</p>
<p>这些宏之间的关系都用代码来描述，需要开发人员熟悉所有代码行为，才能很好的配置这些功能。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CONFIG_TEST_TOP_ENABLE</span>
<span class="cp">#define CONFIG_TEST_SUB_0_ENABLE</span>

<span class="cp">#ifdef CONFIG_TEST_TOP_ENABLE</span>
<span class="cp">#define CONFIG_TEST_SUB_1_ENABLE</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_TEST_SUB_0_ENABLE) &amp;&amp; defined(CONFIG_TEST_SUB_1_ENABLE)</span>
<span class="cp">#define CONFIG_TEST_SHOW_SUB_INT (123)</span>
<span class="cp">#else</span>
<span class="cp">#define CONFIG_TEST_SHOW_SUB_INT (456)</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>预编译管理<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h3>
<p>除了在代码中配置外，也可以通过-D预编译来管理，然后编译全局都有这些配置参数了，对应代码中的宏定义。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">gcc</span><span class="w"> </span><span class="n">xxx</span><span class="w"> </span><span class="o">-</span><span class="n">DCONFIG_TEST_ENABLE</span><span class="w"> </span><span class="o">-</span><span class="n">DCONFIG_TEST_SHOW_INIT</span><span class="o">=</span><span class="mi">123</span><span class="w"></span>

<span class="cp">#define CONFIG_TEST_ENABLE</span>
<span class="cp">#define CONFIG_TEST_SHOW_INIT (123)</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3>问题<a class="headerlink" href="#id4" title="此标题的永久链接"></a></h3>
<p>如果是小型项目通过上述两种方式管理都还好，当项目越来越大时，所需配置的参数越来越多时，希望有一个工具专门来管理这些配置参数，并且能够可视化这些编译配置。</p>
<p>而Kconfig就是这样一个通用的工具来解决这一问题。</p>
</section>
</section>
<section id="id5">
<h2><span class="section-number">3.2. </span>环境搭建<a class="headerlink" href="#id5" title="此标题的永久链接"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>是一个配置描述文件，而其配置界面程序需要通过GUI来完成，不然看到的只是一些文本文件，并且这个文件并不能被c所识别。</p>
<p>这里推荐用python的<a class="reference external" href="https://pypi.org/project/kconfiglib/">kconfiglib · PyPI</a>库来使用。</p>
<section id="kconfiglib">
<h3>Kconfiglib安装<a class="headerlink" href="#kconfiglib" title="此标题的永久链接"></a></h3>
<p>直接python安装即可。由于要使用menuconfig，在windows环境下还需要安装<code class="docutils literal notranslate"><span class="pre">windows-curses</span></code>。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">windows</span><span class="o">-</span><span class="n">curses</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">kconfiglib</span>
</pre></div>
</div>
<p>安装完成后，会在python路径下生成<code class="docutils literal notranslate"><span class="pre">menuconfig.exe</span></code>执行程序。输入<code class="docutils literal notranslate"><span class="pre">menuconfig</span> <span class="pre">-h</span></code>，出现下面的信息说明已经安装好了。</p>
<p><img alt="image-20221021154103835" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021154103835.png" /></p>
</section>
<section id="c-kconfig-py">
<h3>c头文件生成脚本-kconfig.py<a class="headerlink" href="#c-kconfig-py" title="此标题的永久链接"></a></h3>
<p>使用<code class="docutils literal notranslate"><span class="pre">Kconfiglib</span></code>生成的是<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件，而c代码要使用，必须要提供头文件。其实生成功能主要还是依靠<code class="docutils literal notranslate"><span class="pre">kconfiglib</span></code>中提供的<code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">Kconfig</span></code>中的<code class="docutils literal notranslate"><span class="pre">write_autoconf</span></code>方法，但是也需要一个脚本来调用这个库。</p>
<p>源码所在路径为：<a class="reference external" href="https://github.com/ulfalizer/Kconfiglib/blob/master/kconfiglib.py">Kconfiglib/kconfiglib.py at master · ulfalizer/Kconfiglib (github.com)</a></p>
<p><img alt="image-20221021174305501" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021174305501.png" /></p>
<p><a class="reference external" href="https://www.jianshu.com/p/25237ab0bf66">kconfig 实例1: 基于 python 的 kconfig 系统 - 简书 (jianshu.com)</a>这个里面提供了一个简单的实现版本，但是有点太简单了，不符合我们实际项目的需要。</p>
<p><img alt="image-20221021173111119" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021173111119.png" /></p>
<p>这里还是推荐用zephyr项目的版本：<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/scripts/kconfig/kconfig.py">zephyr/kconfig.py at main · zephyrproject-rtos/zephyr (github.com)</a>。这个使用需要输入如下参数：</p>
<ul class="simple">
<li><p>kconfig_file，顶层的Kconfig配置文件路径</p></li>
<li><p>config_out，输出.config文件路径</p></li>
<li><p>header_out，输出c头文件路径</p></li>
<li><p>kconfig_list_out，日志文件</p></li>
<li><p>configs_in，1个或多个输入.config文件</p></li>
</ul>
<p><img alt="image-20221021173232502" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021173232502.png" /></p>
</section>
<section id="gcc">
<h3>GCC安装<a class="headerlink" href="#gcc" title="此标题的永久链接"></a></h3>
<p>这里调试用的是windows环境，直接自行下载msys2+mingw即可。</p>
<p>https://blog.csdn.net/qq_31985307/article/details/114235846</p>
</section>
</section>
<section id="id6">
<h2><span class="section-number">3.3. </span>Kconfig基本概念&amp;语法<a class="headerlink" href="#id6" title="此标题的永久链接"></a></h2>
<section id="id7">
<h3>Kconfig简介<a class="headerlink" href="#id7" title="此标题的永久链接"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>语言定义了一套完整的规则来表述配置项及配置项间的关系。</p>
<p>之前安装的<code class="docutils literal notranslate"><span class="pre">Kconfiglib</span></code>只是用来显示Kconfig的，实际工程中通常会包含<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>和<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件。</p>
<ul class="simple">
<li><p><strong>Kconfig</strong>，是配置项的描述文件，支持设置配置项及其默认值，依赖关系等等，该文件还会继续依赖各个模块的<strong>Kconfig</strong>文件。</p></li>
<li><p><strong>.config</strong>，产品配置文件，提供配置项及在产品中这些配置项的设置值，可能和<strong>Kconfig</strong>配置项的默认取值不一致，属于产品对配置项的定制。这些配置文件在可以在<strong>makefile</strong>文件中使用。</p></li>
<li><p><strong>autoconfig.h</strong>，生成的C语言头文件，提供配置项的宏定义版，在C语言程序中使用。</p></li>
</ul>
</section>
<section id="id8">
<h3>Kconfig语法<a class="headerlink" href="#id8" title="此标题的永久链接"></a></h3>
<p>由于本文重点是讲Kconfig环境的搭建，所以语法就不展开。</p>
<p>linux的原版可以看这个：<a class="reference external" href="https://www.kernel.org/doc/html/latest/kbuild/kconfig-language.html#introduction">Kconfig Language — The Linux Kernel documentation</a></p>
<p>zephyr项目的介绍：<a class="reference external" href="https://docs.zephyrproject.org/latest/build/kconfig/index.html">Configuration System (Kconfig) — Zephyr Project Documentation</a></p>
<p>中文的一些说明：</p>
<p><a class="reference external" href="https://www.cnblogs.com/fluidog/p/15176680.html">Kconfig 语法 - fluidog - 博客园 (cnblogs.com)</a></p>
<p><a class="reference external" href="https://www.jianshu.com/p/aba588d380c2">kconfig语法整理 - 简书 (jianshu.com)</a></p>
</section>
</section>
<section id="id9">
<h2><span class="section-number">3.4. </span>Kconfig实战<a class="headerlink" href="#id9" title="此标题的永久链接"></a></h2>
<p>这里围绕实际使用的几个场景来进行说明</p>
<section id="id10">
<h3>直接配置版本<a class="headerlink" href="#id10" title="此标题的永久链接"></a></h3>
<section id="id11">
<h4>准备<a class="headerlink" href="#id11" title="此标题的永久链接"></a></h4>
<p>需要提供main.c，Makefile，Kconfig。下面分别进行描述：</p>
<p><img alt="image-20221021175825950" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021175825950.png" /></p>
<section id="id12">
<h5>Kconfig<a class="headerlink" href="#id12" title="此标题的永久链接"></a></h5>
<p>这里我们将最开始背景说明中的宏定义配置改成Kconfig写法。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mainmenu</span> <span class="s2">&quot;Kconfig Demo&quot;</span>

<span class="n">menu</span> <span class="s2">&quot;Test Params setting&quot;</span>
<span class="n">config</span> <span class="n">TEST_ENABLE</span>
    <span class="nb">bool</span> <span class="s2">&quot;Enable test work&quot;</span>
    <span class="n">default</span> <span class="n">n</span>
    <span class="n">help</span>
        <span class="n">Will</span> <span class="nb">print</span> <span class="n">debug</span> <span class="n">information</span> <span class="k">if</span> <span class="n">enable</span><span class="o">.</span>

<span class="n">config</span> <span class="n">TEST_SHOW_STRING</span>
    <span class="n">string</span> <span class="s2">&quot;The show string info&quot;</span>
    <span class="n">default</span> <span class="s2">&quot;Test 123&quot;</span>

<span class="n">config</span> <span class="n">TEST_SHOW_INT</span>
    <span class="nb">int</span> <span class="s2">&quot;The show int info&quot;</span>
	<span class="nb">range</span> <span class="mi">0</span> <span class="mi">255</span>
    <span class="n">default</span> <span class="mi">123</span>


<span class="n">config</span> <span class="n">TEST_TOP_ENABLE</span>
	<span class="nb">bool</span> <span class="s2">&quot;Test Top Func&quot;</span>
    <span class="n">default</span> <span class="n">n</span>
    <span class="n">help</span>
        <span class="n">Function</span> <span class="n">Test</span> <span class="n">Top</span>

<span class="n">config</span> <span class="n">TEST_SUB_0_ENABLE</span>
	<span class="nb">bool</span> <span class="s2">&quot;Test Sub 0 Func&quot;</span>
    <span class="n">default</span> <span class="n">n</span>
    <span class="n">help</span>
        <span class="n">Function</span> <span class="n">Test</span> <span class="n">Sub</span> <span class="mi">0</span>

<span class="n">config</span> <span class="n">TEST_SUB_1_ENABLE</span>
	<span class="nb">bool</span> <span class="s2">&quot;Test Sub 1 Func&quot;</span>
    <span class="n">default</span> <span class="n">n</span>
    <span class="n">depends</span> <span class="n">on</span> <span class="n">TEST_TOP_ENABLE</span>
    <span class="n">help</span>
        <span class="n">Function</span> <span class="n">Test</span> <span class="n">Sub</span> <span class="mi">1</span>

<span class="n">config</span> <span class="n">TEST_SHOW_SUB_INT</span>
    <span class="nb">int</span>
    <span class="n">default</span> <span class="mi">456</span> <span class="k">if</span> <span class="n">TEST_SUB_0_ENABLE</span> <span class="o">&amp;&amp;</span> <span class="n">TEST_SUB_1_ENABLE</span>
    <span class="n">default</span> <span class="mi">123</span>


<span class="n">endmenu</span>
</pre></div>
</div>
</section>
<section id="makefile">
<h5>Makefile<a class="headerlink" href="#makefile" title="此标题的永久链接"></a></h5>
<p>相比于传统的makefile，加入了<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>、<code class="docutils literal notranslate"><span class="pre">.config</span></code>和<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>编译目标。</p>
<p><strong>menuconfig</strong>，用于显示menuconfig页面，让用户通过GUI选择当前配置参数。</p>
<p><strong>.config</strong>，如果用户第一次没有<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件时，调用<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>来配置<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>并生成<code class="docutils literal notranslate"><span class="pre">.config</span></code>。</p>
<p><strong>autoconfig.h</strong>，如果<code class="docutils literal notranslate"><span class="pre">.config</span></code>有更新就需要执行，实际是调用<code class="docutils literal notranslate"><span class="pre">kconfig.py</span></code>脚本来生成<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>头文件。</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nf">all</span><span class="o">:</span> <span class="n">main</span>.<span class="n">o</span>
	gcc main.o -o main
<span class="nf">main.o</span><span class="o">:</span> <span class="n">main</span>.<span class="n">c</span> <span class="n">autoconfig</span>.<span class="n">h</span>
	gcc main.c -c -o main.o
<span class="nf">clean</span><span class="o">:</span>
	del main.o main.exe

<span class="nf">autoconfig.h</span><span class="o">:</span>.<span class="n">config</span>
	python ../scripts/kconfig.py Kconfig .config autoconfig.h log.txt .config
<span class="nf">.config</span><span class="o">:</span>
	menuconfig
<span class="nf">menuconfig</span><span class="o">:</span>
	menuconfig
</pre></div>
</div>
</section>
<section id="main-c">
<h5>main.c<a class="headerlink" href="#main-c" title="此标题的永久链接"></a></h5>
<p>比较简单，一个是引用生成的autoconfig.h头文件，然后再根据不同的配置打印当前的信息</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;autoconfig.h&quot;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;hello, world</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#ifdef CONFIG_TEST_ENABLE</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SHOW_STRING: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CONFIG_TEST_SHOW_STRING</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SHOW_INT: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CONFIG_TEST_SHOW_INT</span><span class="p">);</span><span class="w"></span>
<span class="cp">#ifdef CONFIG_TEST_TOP_ENABLE</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_TOP_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_TEST_SUB_0_ENABLE</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SUB_0_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_TEST_SUB_1_ENABLE</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SUB_1_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SHOW_SUB_INT: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CONFIG_TEST_SHOW_SUB_INT</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="id13">
<h4>首次编译<a class="headerlink" href="#id13" title="此标题的永久链接"></a></h4>
<p>直接键入<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>，由于初始环境没有.config文件，会调用menuconfig进行配置生成.config文件。</p>
<p>如下图配置完成后输入<strong>Q</strong>，会提示保存<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件，直接保存即可。</p>
<p><img alt="image-20221021171934216" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021171934216.png" /></p>
<p>有<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件后，就会执行<strong>python</strong>脚本生成<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>文件，最后调用<code class="docutils literal notranslate"><span class="pre">gcc</span></code>生成<code class="docutils literal notranslate"><span class="pre">main.exe</span></code>。</p>
<p><img alt="image-20221021180323871" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021180323871.png" /></p>
<p>执行编译之后，生成的<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>文件信息如下。如上图所示，<code class="docutils literal notranslate"><span class="pre">main.exe</span></code>的执行结果和锁配置的<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>参数相同。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CONFIG_TEST_ENABLE 1</span>
<span class="cp">#define CONFIG_TEST_SHOW_STRING &quot;Test 567&quot;</span>
<span class="cp">#define CONFIG_TEST_SHOW_INT 123</span>
<span class="cp">#define CONFIG_TEST_TOP_ENABLE 1</span>
<span class="cp">#define CONFIG_TEST_SHOW_SUB_INT 123</span>
</pre></div>
</div>
<p>生成的<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件如下，可以看到默认值通过<code class="docutils literal notranslate"><span class="pre">#</span></code>注释了，其他就是我们在<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>所指定的值。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1">#</span>
<span class="c1"># Test Params setting</span>
<span class="c1">#</span>
<span class="n">CONFIG_TEST_ENABLE</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_TEST_SHOW_STRING</span><span class="o">=</span><span class="s2">&quot;Test 567&quot;</span>
<span class="n">CONFIG_TEST_SHOW_INT</span><span class="o">=</span><span class="mi">123</span>
<span class="n">CONFIG_TEST_TOP_ENABLE</span><span class="o">=</span><span class="n">y</span>
<span class="c1"># CONFIG_TEST_SUB_0_ENABLE is not set</span>
<span class="c1"># CONFIG_TEST_SUB_1_ENABLE is not set</span>
<span class="n">CONFIG_TEST_SHOW_SUB_INT</span><span class="o">=</span><span class="mi">123</span>
<span class="c1"># end of Test Params setting</span>
</pre></div>
</div>
<p>如上图所示的执行完程序之后，生成了很多中间文件，和目标文件。真正有用的是<code class="docutils literal notranslate"><span class="pre">.config</span></code>和<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>文件。</p>
<p><img alt="image-20221021200109412" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021200109412.png" /></p>
</section>
<section id="id14">
<h4>调整参数<a class="headerlink" href="#id14" title="此标题的永久链接"></a></h4>
<p>第一次编译完毕以后，之后我们想修改参数可以通过输入<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code>进配置页面，<strong>需要注意的是，这时候打开时，不再是默认值，而是我们之前调整后的值</strong>。</p>
<p>按照如下配置后。</p>
<p><img alt="image-20221021201439203" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021201439203.png" /></p>
<p>修改后，再键入<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>，由于<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>所依赖的<code class="docutils literal notranslate"><span class="pre">.config</span></code>变化了，会触发再次运行<strong>python</strong>脚本生成<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>，再生成<code class="docutils literal notranslate"><span class="pre">main.exe</span></code>。</p>
<p><img alt="image-20221021202232194" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221021202232194.png" /></p>
<p>生成的<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>文件如下所示，从上图的执行结果可以看出行为一致。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#define CONFIG_TEST_ENABLE 1</span>
<span class="cp">#define CONFIG_TEST_SHOW_STRING &quot;Test 567&quot;</span>
<span class="cp">#define CONFIG_TEST_SHOW_INT 78</span>
<span class="cp">#define CONFIG_TEST_TOP_ENABLE 1</span>
<span class="cp">#define CONFIG_TEST_SUB_0_ENABLE 1</span>
<span class="cp">#define CONFIG_TEST_SUB_1_ENABLE 1</span>
<span class="cp">#define CONFIG_TEST_SHOW_SUB_INT 456</span>
</pre></div>
</div>
<p>生成的<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件如下所示，和我们GUI配置的参数一致。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1">#</span>
<span class="c1"># Test Params setting</span>
<span class="c1">#</span>
<span class="n">CONFIG_TEST_ENABLE</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_TEST_SHOW_STRING</span><span class="o">=</span><span class="s2">&quot;Test 567&quot;</span>
<span class="n">CONFIG_TEST_SHOW_INT</span><span class="o">=</span><span class="mi">78</span>
<span class="n">CONFIG_TEST_TOP_ENABLE</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_TEST_SUB_0_ENABLE</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_TEST_SUB_1_ENABLE</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_TEST_SHOW_SUB_INT</span><span class="o">=</span><span class="mi">456</span>
<span class="c1"># end of Test Params setting</span>
</pre></div>
</div>
</section>
<section id="id15">
<h4>总结<a class="headerlink" href="#id15" title="此标题的永久链接"></a></h4>
<p>上述的方案算是一个最常用的方式了，发布的时候只提供<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>，<code class="docutils literal notranslate"><span class="pre">.config</span></code>为默认值生成的，用户需要改的时候自己通过<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code>来修改，以便生成不同的应用程序。</p>
<p>这个方式已经可以满足绝大数应用场景的需要了。</p>
</section>
</section>
<section id="zephyr">
<h3>Zephyr提出的持久化版本/多应用版本<a class="headerlink" href="#zephyr" title="此标题的永久链接"></a></h3>
<p>虽然上述版本已经满足大多数场景需要了，但是对于像Zephyr这种项目，项目非常大，有多个驱动，并且其会提供很多例程，这些例程都是预先配置好参数给客户直接编译下载的。</p>
<p>不同例程之间所使用的参数各不相同，而且还想让客户可以通过GUI调整某个例程的参数信息，这时候如何管理呢。</p>
<p>这对应芯片厂来讲是一个很普遍的需求，芯片厂所提供的SDK一般包含多个例程，不同例程公用驱动库，只是所使用参数不同。</p>
<p>Zephyr原文：<a class="reference external" href="https://docs.zephyrproject.org/latest/build/kconfig/index.html">Configuration System (Kconfig) — Zephyr Project Documentation</a></p>
<p>Zephyr持久化方案实现代码：<a class="reference external" href="https://github.com/zephyrproject-rtos/zephyr/blob/main/cmake/modules/kconfig.cmake">zephyr/kconfig.cmake at main · zephyrproject-rtos/zephyr (github.com)</a></p>
<p><img alt="image-20221022173355536" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022173355536.png" /></p>
<p>好的Zephyr Kconfig使用思路文档：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.panchip.com/pan1080dk-doc/0.5.0/04_dev_guides/zephyr_configuration_guidance.html#">Zephyr Devicetree 与 Kconfig 配置指南 — PAN1080 DK Documentation (panchip.com)</a></p></li>
<li><p><a class="reference external" href="https://blog.csdn.net/u011638175/article/details/121339581">Zephyr-系统配置(Kconfig)_只想.静静的博客-CSDN博客_zephyr如何配置</a></p></li>
</ul>
<p>Zephyr项目有点大，他的一些理念可以学习，但本文会给大家准备一个精简版的例程，借鉴其思路来实现类似其工作效果（学习zephyr可以参考下）。</p>
<section id="id16">
<h4>准备<a class="headerlink" href="#id16" title="此标题的永久链接"></a></h4>
<p>假定有2个例程，每个例程有一个main函数，共同使用一个模块Test。Makefile通过APP参数来指定不同的编译目标，每个应用有其配置参数。项目的目录结构如下图所示。</p>
<ul class="simple">
<li><p><strong>app</strong>，应用路径，下面包含2个例程，分别为test1和test2。每个应用有其独立的配置参数prj.conf。</p></li>
<li><p><strong>driver</strong>，公用的驱动路径，例程会调用这个驱动。</p></li>
<li><p><strong>output</strong>，输出路径，生成的一些文件都放在这，.o为了省事就不放了。</p></li>
<li><p><strong>Kconfig</strong>，kconfig的配置文件，和上一个一样。</p></li>
<li><p><strong>Makefile</strong>，makefile文件。</p></li>
</ul>
<p><img alt="image-20221022153835669" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022153835669.png" /></p>
</section>
<section id="app">
<h4>代码分析-app<a class="headerlink" href="#app" title="此标题的永久链接"></a></h4>
<section id="test1">
<h5>test1<a class="headerlink" href="#test1" title="此标题的永久链接"></a></h5>
<p>main.c文件比较简单，就是打印一个printf，而后就是调用驱动库的函数。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;driver_test.h&quot;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;hello, test1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="n">test_driver</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>prj.conf文件设定了针对test1的配置参数</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_TEST_ENABLE</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_TEST_SHOW_STRING</span><span class="o">=</span><span class="s2">&quot;Test 444&quot;</span>
</pre></div>
</div>
</section>
<section id="test2">
<h5>test2<a class="headerlink" href="#test2" title="此标题的永久链接"></a></h5>
<p><code class="docutils literal notranslate"><span class="pre">main.c</span></code>文件比较简单，就是打印一个printf（<strong>注意</strong>：输出是<code class="docutils literal notranslate"><span class="pre">hello,</span> <span class="pre">test2</span></code>），而后就是调用驱动库的函数。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;driver_test.h&quot;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;hello, test2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="n">test_driver</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">prj.conf</span></code>文件设定了针对test2的配置参数</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG_TEST_TOP_ENABLE</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_TEST_SUB_0_ENABLE</span><span class="o">=</span><span class="n">y</span>
<span class="n">CONFIG_TEST_SUB_1_ENABLE</span><span class="o">=</span><span class="n">n</span>
</pre></div>
</div>
</section>
</section>
<section id="driver">
<h4>代码分析-driver<a class="headerlink" href="#driver" title="此标题的永久链接"></a></h4>
<section id="driver-test-c">
<h5>driver_test.c<a class="headerlink" href="#driver-test-c" title="此标题的永久链接"></a></h5>
<p>其实和上一个例程差不多，就是将配置参数打印出来。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;autoconfig.h&quot;</span><span class="cp"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">test_driver</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="cp">#ifdef CONFIG_TEST_ENABLE</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SHOW_STRING: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CONFIG_TEST_SHOW_STRING</span><span class="p">);</span><span class="w"></span>
<span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SHOW_INT: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CONFIG_TEST_SHOW_INT</span><span class="p">);</span><span class="w"></span>
<span class="cp">#ifdef CONFIG_TEST_TOP_ENABLE</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_TOP_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_TEST_SUB_0_ENABLE</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SUB_0_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_TEST_SUB_1_ENABLE</span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SUB_1_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif</span>
<span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;CONFIG_TEST_SHOW_SUB_INT: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">CONFIG_TEST_SHOW_SUB_INT</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="driver-test-h">
<h5>driver_test.h<a class="headerlink" href="#driver-test-h" title="此标题的永久链接"></a></h5>
<p>没什么东西，就是一个函数声明罢了。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef _DRIVER_TEST_H_</span>
<span class="cp">#define _DRIVER_TEST_H_</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">test_driver</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">//_DRIVER_TEST_H_</span>
</pre></div>
</div>
</section>
</section>
<section id="id17">
<h4>代码分析-Kconfig<a class="headerlink" href="#id17" title="此标题的永久链接"></a></h4>
<p>和之前一模一样，就不重复占页数了。</p>
</section>
<section id="id18">
<h4>代码分析-Makefile<a class="headerlink" href="#id18" title="此标题的永久链接"></a></h4>
<p>整个文件如下所示，相比上一个东西多了不少，需要大家具备一定的makefile的功底，下面简单进行分析。</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">APP</span> <span class="o">?=</span> app/test1
<span class="nv">OUTPUT_PATH</span> <span class="o">:=</span> output

<span class="nv">INCLUDE_PATH</span> <span class="o">:=</span> -I<span class="k">$(</span>APP<span class="k">)</span> -Idriver -I<span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>

<span class="c"># define user .config setting</span>
<span class="nv">USER_CONFIG_SET</span> <span class="o">:=</span> 
<span class="nv">USER_CONFIG_SET</span> <span class="o">+=</span> <span class="k">$(</span>APP<span class="k">)</span>/prj.conf

<span class="c"># define menuconfig .config path</span>
<span class="nv">DOTCONFIG_PATH</span> <span class="o">:=</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/.config

<span class="c"># define user merged path</span>
<span class="nv">USER_RECORD_CONFIG_PATH</span> <span class="o">:=</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/user_record.conf

<span class="c"># define autoconfig.h path</span>
<span class="nv">AUTOCONFIG_H</span> <span class="o">:=</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/autoconfig.h

<span class="c">#define Kconfig path</span>
<span class="nv">KCONFIG_ROOT_PATH</span> <span class="o">:=</span> Kconfig


<span class="c">#For windows work.</span>
<span class="nv">FIXPATH</span> <span class="o">=</span> <span class="k">$(</span>subst /,<span class="se">\,</span><span class="nv">$1</span><span class="k">)</span>


<span class="nf">all</span><span class="o">:</span> <span class="k">$(</span><span class="nv">APP</span><span class="k">)</span>/<span class="n">main</span>.<span class="n">o</span> <span class="n">driver</span>/<span class="n">driver_test</span>.<span class="n">o</span>
	gcc $^ -o <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/main.exe
<span class="nf">$(APP)/main.o</span><span class="o">:</span> <span class="k">$(</span><span class="nv">APP</span><span class="k">)</span>/<span class="n">main</span>.<span class="n">c</span>
	gcc $&lt; <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> -c -o <span class="nv">$@</span>
<span class="nf">driver/driver_test.o</span><span class="o">:</span> <span class="n">driver</span>/<span class="n">driver_test</span>.<span class="n">c</span> <span class="k">$(</span><span class="nv">AUTOCONFIG_H</span><span class="k">)</span>
	gcc $&lt; <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> -c -o <span class="nv">$@</span>

<span class="nf">clean</span><span class="o">:</span>
	del /q /s <span class="k">$(</span>call FIXPATH, <span class="k">$(</span>APP<span class="k">)</span>/main.o driver/driver_test.o <span class="k">$(</span>OUTPUT_PATH<span class="k">))</span>

<span class="nf">$(AUTOCONFIG_H)</span><span class="o">:</span><span class="k">$(</span><span class="nv">DOTCONFIG_PATH</span><span class="k">)</span>
	python ../scripts/kconfig.py <span class="k">$(</span>KCONFIG_ROOT_PATH<span class="k">)</span> <span class="k">$(</span>DOTCONFIG_PATH<span class="k">)</span> <span class="k">$(</span>AUTOCONFIG_H<span class="k">)</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/log.txt <span class="k">$(</span>DOTCONFIG_PATH<span class="k">)</span>

<span class="nf">$(USER_RECORD_CONFIG_PATH)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">USER_CONFIG_SET</span><span class="k">)</span>
	@echo Using user config.
<span class="c">#	create user_record.conf to record current setting.</span>
	@copy <span class="k">$(</span>call FIXPATH, $^<span class="k">)</span> <span class="k">$(</span>call FIXPATH, <span class="nv">$@</span><span class="k">)</span>
<span class="c">#	create .config by user config setting.</span>
	python ../scripts/kconfig.py --handwritten-input-configs <span class="k">$(</span>KCONFIG_ROOT_PATH<span class="k">)</span> <span class="k">$(</span>DOTCONFIG_PATH<span class="k">)</span> <span class="k">$(</span>AUTOCONFIG_H<span class="k">)</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/log.txt <span class="k">$(</span>USER_CONFIG_SET<span class="k">)</span>

<span class="k">export </span><span class="nv">KCONFIG_CONFIG</span><span class="o">=</span><span class="k">$(</span>DOTCONFIG_PATH<span class="k">)</span>
<span class="nf">$(DOTCONFIG_PATH)</span><span class="o">:</span><span class="k">$(</span><span class="nv">USER_RECORD_CONFIG_PATH</span><span class="k">)</span>
	@echo .config updated

<span class="nf">menuconfig</span><span class="o">:</span><span class="k">$(</span><span class="nv">DOTCONFIG_PATH</span><span class="k">)</span>
<span class="c">#	set KCONFIG_CONFIG=$(DOTCONFIG_PATH)</span>
	menuconfig <span class="k">$(</span>KCONFIG_ROOT_PATH<span class="k">)</span>
</pre></div>
</div>
<section id="id19">
<h5>编译应用部分<a class="headerlink" href="#id19" title="此标题的永久链接"></a></h5>
<p>将生成<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>的部分给删除掉，可以看到还是比较清晰的。由于<strong>APP</strong>可能不一样，默认选中<code class="docutils literal notranslate"><span class="pre">app/test1</span></code>，后续可以调用make的时候调整。</p>
<ul class="simple">
<li><p><strong>all</strong>，依赖2个.o文件，最终生成<code class="docutils literal notranslate"><span class="pre">main.exe</span></code>。</p></li>
<li><p><strong>main.o</strong>，依赖<code class="docutils literal notranslate"><span class="pre">main.c</span></code>，最终生成<code class="docutils literal notranslate"><span class="pre">main.o</span></code>。</p></li>
<li><p><strong>driver_test.o</strong>，依赖<code class="docutils literal notranslate"><span class="pre">driver_test.c</span></code>和**<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>**，最终生成<code class="docutils literal notranslate"><span class="pre">driver_test.o</span></code>。</p></li>
<li><p><strong>clean</strong>，删除中间文件</p></li>
</ul>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">APP</span> <span class="o">?=</span> app/test1
<span class="nv">OUTPUT_PATH</span> <span class="o">:=</span> output

<span class="nv">INCLUDE_PATH</span> <span class="o">:=</span> -I<span class="k">$(</span>APP<span class="k">)</span> -Idriver -I<span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>

<span class="c"># define autoconfig.h path</span>
<span class="nv">AUTOCONFIG_H</span> <span class="o">:=</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/autoconfig.h

<span class="c">#For windows work.</span>
<span class="nv">FIXPATH</span> <span class="o">=</span> <span class="k">$(</span>subst /,<span class="se">\,</span><span class="nv">$1</span><span class="k">)</span>

<span class="nf">all</span><span class="o">:</span> <span class="k">$(</span><span class="nv">APP</span><span class="k">)</span>/<span class="n">main</span>.<span class="n">o</span> <span class="n">driver</span>/<span class="n">driver_test</span>.<span class="n">o</span>
	gcc $^ -o <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/main.exe
<span class="nf">$(APP)/main.o</span><span class="o">:</span> <span class="k">$(</span><span class="nv">APP</span><span class="k">)</span>/<span class="n">main</span>.<span class="n">c</span>
	gcc $&lt; <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> -c -o <span class="nv">$@</span>
<span class="nf">driver/driver_test.o</span><span class="o">:</span> <span class="n">driver</span>/<span class="n">driver_test</span>.<span class="n">c</span> <span class="k">$(</span><span class="nv">AUTOCONFIG_H</span><span class="k">)</span>
	gcc $&lt; <span class="k">$(</span>INCLUDE_PATH<span class="k">)</span> -c -o <span class="nv">$@</span>

<span class="nf">clean</span><span class="o">:</span>
	del /q /s <span class="k">$(</span>call FIXPATH, <span class="k">$(</span>APP<span class="k">)</span>/main.o driver/driver_test.o <span class="k">$(</span>OUTPUT_PATH<span class="k">))</span>
</pre></div>
</div>
</section>
<section id="autoconfig-h">
<h5>autoconfig.h部分<a class="headerlink" href="#autoconfig-h" title="此标题的永久链接"></a></h5>
<p>生成<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>相关的代码也不少，先对基本的参数做一些说明。</p>
<p><strong>USER_CONFIG_SET</strong>，用户定义的初始化<code class="docutils literal notranslate"><span class="pre">prj.conf</span></code>，不同例程配置的参数各不相同，当然也可以分成多个文件，这里只使用一个。</p>
<p><strong>DOTCONFIG_PATH</strong>，配置用户<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>和<code class="docutils literal notranslate"><span class="pre">kconfig.py</span></code>来使用的文件，<code class="docutils literal notranslate"><span class="pre">.h</span></code>文件的生成都是用这个文件进行的。</p>
<p><strong>USER_RECORD_CONFIG_PATH</strong>，记录用户定义的config参数，本质就是为了利用<code class="docutils literal notranslate"><span class="pre">makefile</span></code>的文件依赖关系，来记录<code class="docutils literal notranslate"><span class="pre">USER_CONFIG_SET</span></code>有没有改变，如果有改变，就记录改变后的文件，并基于这些配置生成新的<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件。</p>
<p><strong>AUTOCONFIG_H</strong>，最终要生成的<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>文件路径。</p>
<p><strong>KCONFIG_ROOT_PATH</strong>，<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>的路径。</p>
<p><strong>FIXPATH</strong>，windows的<strong>反斜杠</strong>相关问题处理。</p>
<p><strong>$(AUTOCONFIG_H):$(DOTCONFIG_PATH)</strong>，要生成<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>，就会去看<code class="docutils literal notranslate"><span class="pre">.config</span></code>目标是否存在或更新，最终调用<code class="docutils literal notranslate"><span class="pre">kconfig.py</span></code>使用<code class="docutils literal notranslate"><span class="pre">.config</span></code>来生成<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>。</p>
<p><strong>$(USER_RECORD_CONFIG_PATH): $(USER_CONFIG_SET)</strong>，利用<code class="docutils literal notranslate"><span class="pre">makefile</span></code>的规则来记录用户配置的config文件是否有更新，如果有更新会利用windows的<strong>copy</strong>指令记录当前用户的config配置，并调用<code class="docutils literal notranslate"><span class="pre">kconfig.py</span></code>，将用户的config组合生成最终用于生成<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>的<code class="docutils literal notranslate"><span class="pre">.config</span></code>。<strong>–handwritten-input-configs</strong>是<code class="docutils literal notranslate"><span class="pre">zephyr</span></code>项目<code class="docutils literal notranslate"><span class="pre">kconfig.py</span></code>的配置参数，一些检查<strong>overwrite</strong>相关的处理。</p>
<p><strong>export KCONFIG_CONFIG=$(DOTCONFIG_PATH)</strong>，<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>所需的参数，如果要修改<code class="docutils literal notranslate"><span class="pre">.config</span></code>的路径，必须配置该环境变量。</p>
<p><strong>$(DOTCONFIG_PATH):$(USER_RECORD_CONFIG_PATH)</strong>，主要就是为了看用户config是否有修改，如果有就重新生成<code class="docutils literal notranslate"><span class="pre">.config</span></code>。当然如果刚使用时，没有默认的<code class="docutils literal notranslate"><span class="pre">.config</span></code>，就用用户config来生成<code class="docutils literal notranslate"><span class="pre">.config</span></code>。</p>
<p><strong>menuconfig:$(DOTCONFIG_PATH)</strong>，调用<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>来临时配置参数。之前没写这个依赖，是因为所有的配置都是用<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>生成和管理的。而在这里所有的配置参数需要围绕于用户配置参数来进行，所以第一次打开没有<code class="docutils literal notranslate"><span class="pre">.config</span></code>时需要用用户当前配置作为<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>的显示参数，要临时修改也要基于当前应用配置来调整。</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">OUTPUT_PATH</span> <span class="o">:=</span> output

<span class="c"># define user .config setting</span>
<span class="nv">USER_CONFIG_SET</span> <span class="o">:=</span> 
<span class="nv">USER_CONFIG_SET</span> <span class="o">+=</span> <span class="k">$(</span>APP<span class="k">)</span>/prj.conf

<span class="c"># define menuconfig .config path</span>
<span class="nv">DOTCONFIG_PATH</span> <span class="o">:=</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/.config

<span class="c"># define user merged path</span>
<span class="nv">USER_RECORD_CONFIG_PATH</span> <span class="o">:=</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/user_record.conf

<span class="c"># define autoconfig.h path</span>
<span class="nv">AUTOCONFIG_H</span> <span class="o">:=</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/autoconfig.h

<span class="c">#define Kconfig path</span>
<span class="nv">KCONFIG_ROOT_PATH</span> <span class="o">:=</span> Kconfig

<span class="c">#For windows work.</span>
<span class="nv">FIXPATH</span> <span class="o">=</span> <span class="k">$(</span>subst /,<span class="se">\,</span><span class="nv">$1</span><span class="k">)</span>

<span class="nf">$(AUTOCONFIG_H)</span><span class="o">:</span><span class="k">$(</span><span class="nv">DOTCONFIG_PATH</span><span class="k">)</span>
	python ../scripts/kconfig.py <span class="k">$(</span>KCONFIG_ROOT_PATH<span class="k">)</span> <span class="k">$(</span>DOTCONFIG_PATH<span class="k">)</span> <span class="k">$(</span>AUTOCONFIG_H<span class="k">)</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/log.txt <span class="k">$(</span>DOTCONFIG_PATH<span class="k">)</span>

<span class="nf">$(USER_RECORD_CONFIG_PATH)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">USER_CONFIG_SET</span><span class="k">)</span>
	@echo Using user config.
<span class="c">#	create user_record.conf to record current setting.</span>
	@copy <span class="k">$(</span>call FIXPATH, $^<span class="k">)</span> <span class="k">$(</span>call FIXPATH, <span class="nv">$@</span><span class="k">)</span>
<span class="c">#	create .config by user config setting.</span>
	python ../scripts/kconfig.py --handwritten-input-configs <span class="k">$(</span>KCONFIG_ROOT_PATH<span class="k">)</span> <span class="k">$(</span>DOTCONFIG_PATH<span class="k">)</span> <span class="k">$(</span>AUTOCONFIG_H<span class="k">)</span> <span class="k">$(</span>OUTPUT_PATH<span class="k">)</span>/log.txt <span class="k">$(</span>USER_CONFIG_SET<span class="k">)</span>

<span class="k">export </span><span class="nv">KCONFIG_CONFIG</span><span class="o">=</span><span class="k">$(</span>DOTCONFIG_PATH<span class="k">)</span>
<span class="nf">$(DOTCONFIG_PATH)</span><span class="o">:</span><span class="k">$(</span><span class="nv">USER_RECORD_CONFIG_PATH</span><span class="k">)</span>
	@echo .config updated

<span class="nf">menuconfig</span><span class="o">:</span><span class="k">$(</span><span class="nv">DOTCONFIG_PATH</span><span class="k">)</span>
<span class="c">#	set KCONFIG_CONFIG=$(DOTCONFIG_PATH)</span>
	menuconfig <span class="k">$(</span>KCONFIG_ROOT_PATH<span class="k">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id20">
<h4>autoconfig.h生成分析<a class="headerlink" href="#id20" title="此标题的永久链接"></a></h4>
<p>上面讲了一堆的参数，相信大家有点晕了，那回到我们的主题，设计这个复杂的<code class="docutils literal notranslate"><span class="pre">makefile</span></code>最终的目的的参考<code class="docutils literal notranslate"><span class="pre">zephyr</span></code>的持久化版本以及解决多应用版本的需要。</p>
<ul class="simple">
<li><p>一方面，我们希望多个例程之间有不同的配置参数，是在<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>的初始值基础上的不同配置。</p></li>
<li><p>另一方面，我们希望用户可以直接通过<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>看当前的应用最终的配置参数，并且可以通过<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>来基于当前应用配置参数进行调整。</p></li>
</ul>
<p>为了解决上述功能需要才设计了上述那么复杂的东西。</p>
<p>简单来讲，<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>总的有两个修改路径。</p>
<ul class="simple">
<li><p>一个是直接修改用户config文件，这个是<strong>持久化修改方案</strong>，此时再编译会冲刷掉<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>修改的值。</p></li>
<li><p>一个是通过<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>修改<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件，这个是<strong>临时修改方案</strong>，只对当前编译结果有效，会被用户配置给冲刷掉。</p></li>
</ul>
<table border="1" class="docutils">
<thead>
<tr>
<th>目标文件</th>
<th>依赖</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>autoconfig.h</td>
<td>$(APP)/prj.conf</td>
<td>先生成merge.conf，而后用kconfig.py生成.config，最后再使用kconfig.py利用生成的.config生成autoconfig.h</td>
</tr>
<tr>
<td>autoconfig.h</td>
<td>menuconfig直接修改</td>
<td>1. 没有.config，先用prj.conf输入kconfig.py生成.config；2. GUI呈现.config的信息，调整后更新.config；3. 使用kconfig.py利用生成的.config生成autoconfig.h</td>
</tr>
</tbody>
</table></section>
<section id="id21">
<h4>编译<a class="headerlink" href="#id21" title="此标题的永久链接"></a></h4>
<section id="id22">
<h5>首次编译<a class="headerlink" href="#id22" title="此标题的永久链接"></a></h5>
<p>直接<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>。默认选中的是test1例程，编译过程如下。</p>
<p>由于刚开始没有<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件，会使用<code class="docutils literal notranslate"><span class="pre">prj.conf</span></code>文件生成<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件，而后再用生成<code class="docutils literal notranslate"><span class="pre">.config</span></code>文件来生成<code class="docutils literal notranslate"><span class="pre">autoconfig.h</span></code>（<strong>注意</strong>，从图中可以看到，之前就已经生成好了autoconfig.h，后面并没有改变。这里是因为笔者暂时没办法将第一步只做merge动作并生成.config文件，所以只能这样了）。</p>
<p><img alt="image-20221022170159780" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022170159780.png" /></p>
<p>执行结果如下，会产生一些中间文件，直接使用的是test1的配置。</p>
<p><img alt="image-20221022170852961" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022170852961.png" /></p>
<p><img alt="image-20221022171040160" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022171040160.png" /></p>
</section>
<section id="menuconfig">
<h5>通过menuconfig修改参数<a class="headerlink" href="#menuconfig" title="此标题的永久链接"></a></h5>
<p>直接<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">menuconfig</span></code>。显示的配置参数就是默认test1的当前配置。</p>
<p><img alt="image-20221022171315724" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022171315724.png" /></p>
<p>尝试调整值如下，输入<strong>Q</strong>，会提示保存.config，保存即可。</p>
<p><img alt="image-20221022171347634" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022171347634.png" /></p>
<p>这时候编译结果如下，可以看出和我们GUI配置的参数一致。</p>
<p><img alt="image-20221022171716523" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022171716523.png" /></p>
</section>
<section id="user-prj">
<h5>修改user.prj的参数<a class="headerlink" href="#user-prj" title="此标题的永久链接"></a></h5>
<p>直接文本操作，将test1目录下的prj.conf进行修改，修改后再通过<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>编译，过程如下图。</p>
<p>可以看出刚刚通过menuconfig配置的.config被覆盖了，使用的是最新的用户配置参数，结果如下所示。</p>
<p><img alt="image-20221022172313117" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022172313117.png" /></p>
</section>
</section>
<section id="id23">
<h4>不同应用编译<a class="headerlink" href="#id23" title="此标题的永久链接"></a></h4>
<p>test1的编译结果如上，clean完工程后，我们输入<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span> <span class="pre">APP=app\test2</span></code>。得到的结果如下：</p>
<p>可以看出这时候用的是test2的配置参数，执行结果也符合预期。</p>
<p><img alt="image-20221022172640410" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221022172640410.png" /></p>
</section>
<section id="prj-conf">
<h4>生成持久化所需的prj.conf<a class="headerlink" href="#prj-conf" title="此标题的永久链接"></a></h4>
<p>从上面的分析可以看出，之后发布给客户的时候不同应用就有其独特的配置了。</p>
<p>但是问题来了，要如何生成<code class="docutils literal notranslate"><span class="pre">prj.conf</span></code>文件呢，<code class="docutils literal notranslate"><span class="pre">menuconfig</span></code>提供了一个保存差异的功能，进入GUI修改完参数后，可以输入<strong>D</strong>就可以输出差异配置了，这个差异配置放到<code class="docutils literal notranslate"><span class="pre">prj.conf</span></code>中即可。</p>
<p><strong>注意</strong>：这里生成的是相对于<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>的差异文件，并不是基于当前配置的差异。</p>
<p><img alt="image-20221022173021662" src="https://img-blog.csdnimg.cn/img_convert/b5feb8a856375104c3726cca9bf68523.png" /></p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="02_makefile_shell_env.html" class="btn btn-neutral float-left" title="2. 使用Eclipse CDT build tools之后导致makefile环境错乱的问题" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../../16_ColeStudy/index.html" class="btn btn-neutral float-right" title="NORDIC:ColeStudy" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2020, apache.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>