<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10. 1 前言 &mdash; bluetoothlover_wiki 0.0.1 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="NORDIC:xiangxistu" href="../../13_xiangxistu/index.html" />
    <link rel="prev" title="7. 1 前言" href="AN02_RT-Thread_PM2.0_nRF52xx_Power_and_Clock.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> bluetoothlover_wiki
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">BLE knowledge:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ble/index.html">BLE STACK篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ble_profile/index.html">BLE PROFILE篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nordic/index.html">Nordic 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WB55/index.html">STM32WB55 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WIKI_FAQ/index.html">WIKI FAQ 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RTTHREAD/index.html">RTTHRED: RT-Thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../12_ESP32/index.html">ESP32</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DEBUG/index.html">EMBEDDED DEBUG 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_supperthomas/index.html">MASTER:supperthomas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_helloworldzlg/index.html">WB55:helloworldzlg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_Jackistang/index.html">WB55:Jackistang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_xupenghu/index.html">WB55:xupenghu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_dozingfiretruck/index.html">WB55:dozingfiretruck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05_luhuadong/index.html">WB55:luhuadong</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_answerinthewind/index.html">WB55:answerinthewind</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06_chenyingchun0312/index.html">NORDIC:chenyingchun0312</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../07_ylz0923/index.html">NORDIC:ylz0923</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../08_guohp1128/index.html">NORDIC:guohp1128</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10_jiy/index.html">NORDIC:jiy</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">NORDIC:ForestRain</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01_introduce/01_intruduce.html">1. 简单自我介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html">2. 1 前言</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html#lorawan-class-a">3. 2 LoRaWAN Class A终端设备的低功耗设计</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html#id6">4. 3 LoRaWAN Class A终端设备的应用示例</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html#id10">5. 4 功耗测试结果</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html#id11">6. 5 参考</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN02_RT-Thread_PM2.0_nRF52xx_Power_and_Clock.html">7. 1 前言</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN02_RT-Thread_PM2.0_nRF52xx_Power_and_Clock.html#nrf52">8. 2 nRF52系列的低功耗相关硬件特性</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN02_RT-Thread_PM2.0_nRF52xx_Power_and_Clock.html#id4">9. 3 硬件电路的相关功耗设计</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10. 1 前言</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rt-thread-pm">11. 2 RT-Thread PM组件简介</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">11.1. 2.1 工作原理</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">11.2. 2.2 设计架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">11.3. 2.3 低功耗状态和模式</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">2.3.1 休眠状态</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">2.3.2 运行状态</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id7">11.4. 2.4 调用流程</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">11.5. 2.5 查看模式状态</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mcu">11.6. 2.6 MCU平台适配</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rtt-pm-bsp">11.7. </a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nrf52-pm">12. 3 nRF52系列 PM适配</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pm">12.1. 3.1 PM功耗等级</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">12.2. 3.2 PM使用的定时器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">12.3. 3.3 新增适配文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="#board-kconfig">12.4. 3.4 修改board\kconfig文件</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id11">13. 4 nRF52系列 PM使用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nrf5xx-nrfx">13.1. 4.1 使能nrf5xx软件包(nrfx驱动库)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">13.2. 4.2 使能PM功能</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bsppm">4.2.1 bsp使能PM功能</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id13">4.2.2 使能PM组件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#idle">4.2.3 修改IDLE任务栈大小</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id14">14. 5 测试示例</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id15">14.1. 5.1 应用测试代码</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id16">14.2. 5.1 pm测试命令</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../13_xiangxistu/index.html">NORDIC:xiangxistu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../14_bobwenstudy/index.html">NORDIC:bobwenstudy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../16_ColeStudy/index.html">NORDIC:ColeStudy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">bluetoothlover_wiki</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">NORDIC:ForestRain</a></li>
      <li class="breadcrumb-item active"><span class="section-number">10. </span>1 前言</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/11_ForestRain/02_PM/AN03_RT-Thread_PM2.0_nRF52xx_PM_Driver.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1><span class="section-number">10. </span>1 前言<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h1>
<p>本文主要描述了nRF52系列适配RT-Thread PM2.0组件。目前基于nrf52840 DK进行初步功能测试。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/Forest-Rain/rt-thread/tree/master/bsp/nrf5x/nrf52840">测试代码仓库</a></p></li>
</ul>
</section>
<section id="rt-thread-pm">
<h1><span class="section-number">11. </span>2 RT-Thread PM组件简介<a class="headerlink" href="#rt-thread-pm" title="此标题的永久链接"></a></h1>
<p>本章节内容摘自RT-Thread官方文档《<a class="reference external" href="https://www.rt-thread.org/document/site/#/rt-thread-version/rt-thread-standard/programming-manual/pm/pm?id=%e7%94%b5%e6%ba%90%e7%ae%a1%e7%90%86%e7%bb%84%e4%bb%b6">电源管理组件</a>》</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.rt-thread.org/document/site/#/rt-thread-version/rt-thread-standard/programming-manual/pm/pm">https://www.rt-thread.org/document/site/#/rt-thread-version/rt-thread-standard/programming-manual/pm/pm</a></p></li>
</ul>
<p>RT-Thread 的 PM 组件采用分层设计思想，分离架构和芯片相关的部分，提取公共部分作为核心。在对上层提供通用的接口同时，也让底层驱动对组件的适配变得更加简单。
<img alt="rtt-pm" src="../../_images/002.png" /></p>
<section id="id2">
<h2><span class="section-number">11.1. </span>2.1 <a class="reference external" href="https://www.rt-thread.org/document/site/#/rt-thread-version/rt-thread-standard/programming-manual/pm/pm?id=%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86">工作原理</a><a class="headerlink" href="#id2" title="此标题的永久链接"></a></h2>
<p>低功耗的本质是系统空闲时 CPU 停止工作，中断或事件唤醒后继续工作。在 RTOS 中，通常包含一个 IDLE 任务，该任务的优先级最低且一直保持就绪状态，当高优先级任务未就绪时，OS 执行 IDLE 任务。一般地，未进行低功耗处理时，CPU 在 IDLE 任务中循环执行空指令。RT-Thread 的电源管理组件在 IDLE 任务中，通过对 CPU 、时钟和设备等进行管理，从而有效降低系统的功耗。
<img alt="rtt-pm-tickless" src="../../_images/014.png" /></p>
</section>
<section id="id3">
<h2><span class="section-number">11.2. </span>2.2 <a class="reference external" href="https://www.rt-thread.org/document/site/#/rt-thread-version/rt-thread-standard/programming-manual/pm/pm?id=%e8%ae%be%e8%ae%a1%e6%9e%b6%e6%9e%84">设计架构</a><a class="headerlink" href="#id3" title="此标题的永久链接"></a></h2>
<p>在 RT-Thread PM 组件中，外设或应用通过投票机制对所需的功耗模式进行投票，当系统空闲时，根据投票数决策出合适的功耗模式，调用抽象接口，控制芯片进入低功耗状态，从而降低系统功耗。当未进行任何投票时，会以默认模式进入(通常为空闲模式)。与应用不同，某些外设可能在进入低功耗状态时执行特定操作，退出低功耗时采取措施恢复，此时可以通过注册PM设备来实现。通过注册 PM 设备，在进入低功耗状态之前，会触发注册设备的 suspend 回调，开发者可在回调里执行自己的操作；类似地，从低功耗状态退出时，也会触发 resume 回调。
<img alt="rtt-pm-arch" src="../../_images/024.png" /></p>
</section>
<section id="id4">
<h2><span class="section-number">11.3. </span>2.3 <a class="reference external" href="https://www.rt-thread.org/document/site/#/rt-thread-version/rt-thread-standard/programming-manual/pm/pm?id=%e4%bd%8e%e5%8a%9f%e8%80%97%e7%8a%b6%e6%80%81%e5%92%8c%e6%a8%a1%e5%bc%8f">低功耗状态和模式</a><a class="headerlink" href="#id4" title="此标题的永久链接"></a></h2>
<p>RT-Thread PM 组件将系统划分为两种状态:<strong>运行状态(RUN</strong>)和<strong>休眠状态(Sleep)</strong>。 运行状态控制 CPU 的频率，适用于变频场景；休眠状态根据 SOC 特性实现休眠 CPU，以降低功耗。两种状态分别使用不同的 API 接口，独立控制。</p>
<section id="id5">
<h3>2.3.1 休眠状态<a class="headerlink" href="#id5" title="此标题的永久链接"></a></h3>
<p>休眠状态也就是通常意义上的低功耗状态，通过关闭外设、执行 SOC 电源管理接口，降低系统功耗。 休眠状态又分为六个模式，呈现为金字塔的形式。随着模式增加，功耗逐级递减的特点。下面是休眠状态下模式的定义，开发者可根据具体的 SOC 实现相应的模式，但需要遵循功耗逐级降低的特点。</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>模式</th>
<th>级别</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>PM_SLEEP_MODE_NONE</td>
<td>0</td>
<td>系统处于活跃状态，未采取任何的降低功耗状态</td>
</tr>
<tr>
<td>PM_SLEEP_MODE_IDLE</td>
<td>1</td>
<td>空闲模式，该模式在系统空闲时停止 CPU 和部分时钟，任意事件或中断均可以唤醒</td>
</tr>
<tr>
<td>PM_SLEEP_MODE_LIGHT</td>
<td>2</td>
<td>轻度睡眠模式，CPU 停止，多数时钟和外设停止，唤醒后需要进行时间补偿</td>
</tr>
<tr>
<td>PM_SLEEP_MODE_DEEP</td>
<td>3</td>
<td>深度睡眠模式，CPU 停止，仅少数低功耗外设工作，可被特殊中断唤醒</td>
</tr>
<tr>
<td>PM_SLEEP_MODE_STANDBY</td>
<td>4</td>
<td>待机模式，CPU 停止，设备上下文丢失(可保存至特殊外设)，唤醒后通常复位</td>
</tr>
<tr>
<td>PM_SLEEP_MODE_SHUTDOWN</td>
<td>5</td>
<td>关断模式，比 Standby 模式功耗更低， 上下文通常不可恢复， 唤醒后复位</td>
</tr>
</tbody>
</table></section>
<section id="id6">
<h3>2.3.2 运行状态<a class="headerlink" href="#id6" title="此标题的永久链接"></a></h3>
<p>运行状态通常用于改变 CPU 的运行频率，独立于休眠模式。当前运行状态划分了四个等级：高速、正常、中速、低速，如下：</p>
<table border="1" class="docutils">
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>PM_RUN_MODE_HIGH_SPEED</td>
<td>高速模式，适用于一些超频的场景</td>
</tr>
<tr>
<td>PM_RUN_MODE_NORMAL_SPEED</td>
<td>正常模式，该模式作为默认的运行状态</td>
</tr>
<tr>
<td>PM_RUN_MODE_MEDIUM_SPEED</td>
<td>中速模式，降低 CPU 运行速度，从而降低运行功耗</td>
</tr>
<tr>
<td>PM_RUN_MODE_LOW_SPEED</td>
<td>低速模式，CPU 频率进一步降低</td>
</tr>
</tbody>
</table></section>
</section>
<section id="id7">
<h2><span class="section-number">11.4. </span>2.4 <a class="reference external" href="https://www.rt-thread.org/document/site/#/rt-thread-version/rt-thread-standard/programming-manual/pm/pm?id=%e8%b0%83%e7%94%a8%e6%b5%81%e7%a8%8b">调用流程</a><a class="headerlink" href="#id7" title="此标题的永久链接"></a></h2>
<p><img alt="rtt-pm-flu" src="../../_images/034.png" /></p>
</section>
<section id="id8">
<h2><span class="section-number">11.5. </span>2.5 <a class="reference external" href="https://www.rt-thread.org/document/site/#/rt-thread-version/rt-thread-standard/programming-manual/pm/pm?id=%e6%9f%a5%e7%9c%8b%e6%a8%a1%e5%bc%8f%e7%8a%b6%e6%80%81">查看模式状态</a><a class="headerlink" href="#id8" title="此标题的永久链接"></a></h2>
<p>可以使用 pm_dump 命令查看 PM 组件的模式状态，使用示例如下所示：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="n">pm_dump</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Power</span><span class="w"> </span><span class="n">Management</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Timer</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">None</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">Idle</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">       </span><span class="n">LightSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">        </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">          </span><span class="n">Standby</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">         </span><span class="n">Shutdown</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w"> </span><span class="n">LightSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w">   </span><span class="n">Normal</span><span class="w"> </span><span class="n">Speed</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
</pre></div>
</div>
<p>错误复制成功
在 pm_dump 的模式列表里，休眠模式的优先级是从高到低排列，</p>
<ul class="simple">
<li><p>Counter 一栏标识请求的计数值，图中表明 LightSleep 模式被请求一次，因此当前工作在轻度休眠状态</p></li>
<li><p>Timer 一栏标识是否开启睡眠时间补偿，图中仅深度睡眠(DeepSleep)模式进行时间补偿。</p></li>
<li><p>最下面分别标识当前所处的休眠模式及运行模式等级。</p></li>
</ul>
</section>
<section id="mcu">
<h2><span class="section-number">11.6. </span>2.6 MCU<a class="reference external" href="https://club.rt-thread.org/ask/article/ac629960a10ba8c2.html">平台适配</a><a class="headerlink" href="#mcu" title="此标题的永久链接"></a></h2>
<p>具体可参考 <a class="reference external" href="https://club.rt-thread.org/ask/article/ac629960a10ba8c2.html">RT-Thread PM2.0 应用 — 平台适配篇</a></p>
</section>
<section id="rtt-pm-bsp">
<h2><span class="section-number">11.7. </span><img alt="rtt-pm-bsp" src="../../_images/044.png" /><a class="headerlink" href="#rtt-pm-bsp" title="此标题的永久链接"></a></h2>
</section>
</section>
<section id="nrf52-pm">
<h1><span class="section-number">12. </span>3 nRF52系列 PM适配<a class="headerlink" href="#nrf52-pm" title="此标题的永久链接"></a></h1>
<section id="pm">
<h2><span class="section-number">12.1. </span>3.1 PM功耗等级<a class="headerlink" href="#pm" title="此标题的永久链接"></a></h2>
<p>| <strong>序号</strong> | <strong>RT-Thread PM2.0功耗等级</strong> | <strong>STM32L4平台</strong> | <strong>nRF52平台</strong> |
| — | — | — | — |
| 0 | PM_SLEEP_MODE_NONE | Active Mode | Active Mode |
| 1 | PM_SLEEP_MODE_IDLE | Run Mode | - |
| 2 | PM_SLEEP_MODE_LIGHT | LP SLEEP Mode | SYSTEM ON(Constant Latency) |
| 3 | PM_SLEEP_MODE_DEEP | STOP2 Mode | SYSTEM ON(Low-power Mode) |
| 4 | PM_SLEEP_MODE_STANDBY | Standby Mode | SYSTEM OFF
(RAM retention) |
| 5 | PM_SLEEP_MODE_SHUTDOWN | Shutdown Mode | SYSTEM OFF
(no RAM retention) |</p>
</section>
<section id="id9">
<h2><span class="section-number">12.2. </span>3.2 PM使用的定时器<a class="headerlink" href="#id9" title="此标题的永久链接"></a></h2>
<p>nRF PM主要使用了2类定时器资源，缺省都是来自RTC2。</p>
<ul class="simple">
<li><p>OS tick: RTC2 Tick (NRF_DRV_RTC_INT_TICK)。为了更好实现低功耗，采用RTC2 tick来取代systick定时器。</p></li>
<li><p>Tickless Timer : RTC2 COMPARE Channel 0 (NRF_DRV_RTC_INT_COMPARE0)</p></li>
</ul>
</section>
<section id="id10">
<h2><span class="section-number">12.3. </span>3.3 新增适配文件<a class="headerlink" href="#id10" title="此标题的永久链接"></a></h2>
<p>新增drv_pm.c,drv_lptim.c，文件放在rt-thread\bsp\nrf5x\libraries\drivers</p>
<ul class="simple">
<li><p>drv_pm.c用于实现nrf低功耗的处理</p></li>
<li><p>drv_lptim.c用于实现tickless定时器的处理。
修改rt-thread\bsp\nrf5x\libraries\drivers\SConscript
<img alt="rtt-pm-component" src="../../_images/054.png" /></p></li>
</ul>
</section>
<section id="board-kconfig">
<h2><span class="section-number">12.4. </span>3.4 修改board\kconfig文件<a class="headerlink" href="#board-kconfig" title="此标题的永久链接"></a></h2>
<p>新增pm选项，可直接通过该选项自动使能PM组件所需依赖文件。</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="n">menuconfig</span><span class="w"> </span><span class="n">BSP_USING_PM</span><span class="w"></span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="s">&quot;Enable PM&quot;</span><span class="w"></span>
<span class="w">    </span><span class="n">select</span><span class="w"> </span><span class="n">RT_USING_PM</span><span class="w"></span>
<span class="w">    </span><span class="k">default</span><span class="w"> </span><span class="n">n</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">BSP_USING_PM</span><span class="w"></span>
<span class="w">        </span><span class="n">config</span><span class="w"> </span><span class="n">NRFX_RTC_ENABLED</span><span class="w"></span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span>
<span class="w">        </span><span class="k">default</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">        </span><span class="n">choice</span><span class="w"></span>
<span class="w">            </span><span class="n">prompt</span><span class="w"> </span><span class="s">&quot;Select PM LPTIM&quot;</span><span class="w"></span>
<span class="w">            </span><span class="k">default</span><span class="w"> </span><span class="n">PM_LPTIM_USING_NRFX_RTC2_ENABLED</span><span class="w"></span>

<span class="w">            </span><span class="n">config</span><span class="w"> </span><span class="n">PM_LPTIM_USING_NRFX_RTC1_ENABLED</span><span class="w"></span>
<span class="w">                </span><span class="kt">bool</span><span class="w"> </span><span class="s">&quot;RTC1&quot;</span><span class="w"></span>

<span class="w">            </span><span class="n">config</span><span class="w"> </span><span class="n">PM_LPTIM_USING_NRFX_RTC2_ENABLED</span><span class="w"></span>
<span class="w">                </span><span class="kt">bool</span><span class="w"> </span><span class="s">&quot;RTC2&quot;</span><span class="w"></span>
<span class="w">        </span><span class="n">endchoice</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">PM_LPTIM_USING_NRFX_RTC1_ENABLED</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">PM_LPTIM_USING_NRFX_RTC2_ENABLED</span><span class="w"></span>
<span class="w">            </span><span class="n">config</span><span class="w"> </span><span class="n">RTC_INSTANCE_ID</span><span class="w"></span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span>
<span class="w">                </span><span class="k">default</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">config</span><span class="w"> </span><span class="n">NRFX_RTC1_ENABLED</span><span class="w"></span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span>
<span class="w">                </span><span class="k">default</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="n">endif</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="n">PM_LPTIM_USING_NRFX_RTC1_ENABLED</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">PM_LPTIM_USING_NRFX_RTC2_ENABLED</span><span class="w"></span>
<span class="w">            </span><span class="n">config</span><span class="w"> </span><span class="n">RTC_INSTANCE_ID</span><span class="w"></span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span>
<span class="w">                </span><span class="k">default</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">            </span><span class="n">config</span><span class="w"> </span><span class="n">NRFX_RTC2_ENABLED</span><span class="w"></span>
<span class="w">                </span><span class="kt">int</span><span class="w"> </span>
<span class="w">                </span><span class="k">default</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="n">endif</span><span class="w"></span>
<span class="w">    </span><span class="n">endif</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="id11">
<h1><span class="section-number">13. </span>4 nRF52系列 PM使用<a class="headerlink" href="#id11" title="此标题的永久链接"></a></h1>
<section id="nrf5xx-nrfx">
<h2><span class="section-number">13.1. </span>4.1 使能nrf5xx软件包(nrfx驱动库)<a class="headerlink" href="#nrf5xx-nrfx" title="此标题的永久链接"></a></h2>
<div class="highlight-basic notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span><span class="w"> </span><span class="vg">pkgs</span><span class="w"> </span><span class="o">--</span><span class="vg">update</span>
<span class="o">.....</span>
<span class="o">==============================&gt;</span><span class="w">  </span><span class="vg">NRFX</span><span class="w"> </span><span class="vg">latest</span><span class="w"> </span><span class="vg">is</span><span class="w"> </span><span class="vg">downloaded</span><span class="w"> </span><span class="vg">successfully</span><span class="o">.</span>

<span class="o">==============================&gt;</span><span class="w">  </span><span class="vg">nrfx</span><span class="w"> </span><span class="vg">update</span><span class="w"> </span><span class="vg">done</span>

<span class="vg">Operation</span><span class="w"> </span><span class="vg">completed</span><span class="w"> </span><span class="vg">successfully</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="id12">
<h2><span class="section-number">13.2. </span>4.2 使能PM功能<a class="headerlink" href="#id12" title="此标题的永久链接"></a></h2>
<section id="bsppm">
<h3>4.2.1 bsp使能PM功能<a class="headerlink" href="#bsppm" title="此标题的永久链接"></a></h3>
<p>​	bsp使能PM功能，当前默认PM使用RTC2定时器</p>
<p><img alt="nrfx-power" src="../../_images/06-0.png" /></p>
</section>
<section id="id13">
<h3>4.2.2 使能PM组件<a class="headerlink" href="#id13" title="此标题的永久链接"></a></h3>
<p>如果“4.2.1”使能PM功能，则会自动使能PM组件，如果没有，则可自行使能，如下所示：
<img alt="nrfx-power" src="../../_images/064.png" /></p>
</section>
<section id="idle">
<h3>4.2.3 修改IDLE任务栈大小<a class="headerlink" href="#idle" title="此标题的永久链接"></a></h3>
<p><img alt="rtt-pm-idle" src="../../_images/074.png" />
否则会提示如下错误</p>
<div class="highlight-basic notranslate"><div class="highlight"><pre><span></span>error:  #35: #error directive: &quot;[pm.c ERR] IDLE Stack Size Too Small!&quot;
#error &quot;[pm.c ERR] IDLE Stack Size Too Small!&quot;
</pre></div>
</div>
</section>
</section>
</section>
<section id="id14">
<h1><span class="section-number">14. </span>5 测试示例<a class="headerlink" href="#id14" title="此标题的永久链接"></a></h1>
<section id="id15">
<h2><span class="section-number">14.1. </span>5.1 应用测试代码<a class="headerlink" href="#id15" title="此标题的永久链接"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;rtthread.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;board.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;rtdevice.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;drv_gpio.h&quot;</span><span class="c1">//GET_PIN</span><span class="cp"></span>

<span class="cp">#define DBG_ENABLE</span>
<span class="cp">#define DBG_SECTION_NAME    &quot;button&quot;</span>
<span class="cp">#define DBG_LEVEL           DBG_LOG</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;rtdbg.h&gt;</span><span class="cp"></span>

<span class="cp">#define LED_1          GET_PIN(0,13) </span><span class="c1">//P0.13</span>
<span class="cp">#define PIN_BUTTON1    GET_PIN(0,11)</span>
<span class="cp">#define PIN_BUTTON2    GET_PIN(0,12)</span>
<span class="cp">#define PIN_BUTTON3    GET_PIN(0,24)</span>
<span class="cp">#define PIN_BUTTON4    GET_PIN(0,25)</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">button1_irq_callback</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">parameter</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_write</span><span class="p">(</span><span class="n">LED_1</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_LOW</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pm_module_request</span><span class="p">(</span><span class="n">PM_KEY_ID</span><span class="p">,</span><span class="w"> </span><span class="n">PM_SLEEP_MODE_NONE</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">LOG_D</span><span class="p">(</span><span class="s">&quot;[button1_irq: Request - PM_KEY_ID - PM_SLEEP_MODE_NONE]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">button2_irq_callback</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">parameter</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_write</span><span class="p">(</span><span class="n">LED_1</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_HIGH</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pm_module_release</span><span class="p">(</span><span class="n">PM_KEY_ID</span><span class="p">,</span><span class="w"> </span><span class="n">PM_SLEEP_MODE_NONE</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">LOG_D</span><span class="p">(</span><span class="s">&quot;[button2_irq: Release - PM_KEY_ID - PM_SLEEP_MODE_NONE]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">button3_irq_callback</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">parameter</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">button3_status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0x00</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">button3_status</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="mh">0x01</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">button3_status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x00</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">rt_pin_write</span><span class="p">(</span><span class="n">LED_1</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_HIGH</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">rt_pm_release</span><span class="p">(</span><span class="n">PM_SLEEP_MODE_LIGHT</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">LOG_D</span><span class="p">(</span><span class="s">&quot;[button1_irq: Release - PM_SLEEP_MODE_LIGHT]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">rt_pin_write</span><span class="p">(</span><span class="n">LED_1</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_LOW</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">rt_pm_request</span><span class="p">(</span><span class="n">PM_SLEEP_MODE_LIGHT</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">LOG_D</span><span class="p">(</span><span class="s">&quot;[button1_irq: Request - PM_SLEEP_MODE_LIGHT]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">button4_irq_callback</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">parameter</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pm_request</span><span class="p">(</span><span class="n">PM_SLEEP_MODE_SHUTDOWN</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">LOG_D</span><span class="p">(</span><span class="s">&quot;[button1_irq: Request - PM_SLEEP_MODE_SHUTDOWN]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">button_gpio_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">LOG_D</span><span class="p">(</span><span class="s">&quot;button_gpio_init.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* set key pin mode to input */</span><span class="w"></span>
<span class="w">    </span><span class="n">LOG_D</span><span class="p">(</span><span class="s">&quot;PIN_BUTTON1=%d,PIN_BUTTON2=%d,PIN_BUTTON3=%d,PIN_BUTTON4=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">                </span><span class="n">PIN_BUTTON1</span><span class="p">,</span><span class="n">PIN_BUTTON2</span><span class="p">,</span><span class="n">PIN_BUTTON3</span><span class="p">,</span><span class="n">PIN_BUTTON4</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="cm">/* set interrupt mode and attach interrupt callback function */</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_attach_irq</span><span class="p">(</span><span class="n">PIN_BUTTON1</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_IRQ_MODE_FALLING</span><span class="p">,</span><span class="w"> </span><span class="n">button1_irq_callback</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_attach_irq</span><span class="p">(</span><span class="n">PIN_BUTTON2</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_IRQ_MODE_FALLING</span><span class="p">,</span><span class="w"> </span><span class="n">button2_irq_callback</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_attach_irq</span><span class="p">(</span><span class="n">PIN_BUTTON3</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_IRQ_MODE_FALLING</span><span class="p">,</span><span class="w"> </span><span class="n">button3_irq_callback</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_attach_irq</span><span class="p">(</span><span class="n">PIN_BUTTON4</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_IRQ_MODE_FALLING</span><span class="p">,</span><span class="w"> </span><span class="n">button4_irq_callback</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="cm">/* enable interrupt */</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_irq_enable</span><span class="p">(</span><span class="n">PIN_BUTTON1</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_IRQ_ENABLE</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_irq_enable</span><span class="p">(</span><span class="n">PIN_BUTTON2</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_IRQ_ENABLE</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_irq_enable</span><span class="p">(</span><span class="n">PIN_BUTTON3</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_IRQ_ENABLE</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">rt_pin_irq_enable</span><span class="p">(</span><span class="n">PIN_BUTTON4</span><span class="p">,</span><span class="w"> </span><span class="n">PIN_IRQ_ENABLE</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">RT_EOK</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">INIT_APP_EXPORT</span><span class="p">(</span><span class="n">button_gpio_init</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id16">
<h2><span class="section-number">14.2. </span>5.1 pm测试命令<a class="headerlink" href="#id16" title="此标题的永久链接"></a></h2>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="n">pm_dump</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Power</span><span class="w"> </span><span class="n">Management</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Timer</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">None</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">Idle</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">       </span><span class="n">LightSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">        </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">          </span><span class="n">Standby</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">         </span><span class="n">Shutdown</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w"> </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w">   </span><span class="n">Normal</span><span class="w"> </span><span class="n">Speed</span><span class="w"></span>

<span class="o">|</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">timeout</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="o">|</span><span class="w">  </span><span class="mo">0001</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="p">[</span><span class="n">D</span><span class="o">/</span><span class="n">button</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">button1_irq</span><span class="o">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_KEY_ID</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_SLEEP_MODE_NONE</span><span class="p">]</span><span class="w"></span>

<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="n">pm_dump</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Power</span><span class="w"> </span><span class="n">Management</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Timer</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">None</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">Idle</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">       </span><span class="n">LightSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">        </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">          </span><span class="n">Standby</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">         </span><span class="n">Shutdown</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="n">Mode</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w">   </span><span class="n">Normal</span><span class="w"> </span><span class="n">Speed</span><span class="w"></span>

<span class="o">|</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">timeout</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="o">|</span><span class="w">  </span><span class="mo">0001</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">  </span><span class="mo">0015</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="p">[</span><span class="n">D</span><span class="o">/</span><span class="n">button</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">button1_irq</span><span class="o">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_KEY_ID</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_SLEEP_MODE_NONE</span><span class="p">]</span><span class="w"></span>


<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="n">pm_dump</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Power</span><span class="w"> </span><span class="n">Management</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Timer</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">None</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">2</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">Idle</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">       </span><span class="n">LightSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">        </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">          </span><span class="n">Standby</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">         </span><span class="n">Shutdown</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w"> </span><span class="n">None</span><span class="w"> </span><span class="n">Mode</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w">   </span><span class="n">Normal</span><span class="w"> </span><span class="n">Speed</span><span class="w"></span>

<span class="o">|</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">timeout</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="o">|</span><span class="w">  </span><span class="mo">0001</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">  </span><span class="mo">0015</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="p">[</span><span class="n">D</span><span class="o">/</span><span class="n">button</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">button2_irq</span><span class="o">:</span><span class="w"> </span><span class="n">Release</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_KEY_ID</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_SLEEP_MODE_NONE</span><span class="p">]</span><span class="w"></span>

<span class="p">[</span><span class="n">D</span><span class="o">/</span><span class="n">button</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">button2_irq</span><span class="o">:</span><span class="w"> </span><span class="n">Release</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_KEY_ID</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_SLEEP_MODE_NONE</span><span class="p">]</span><span class="w"></span>

<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="n">pm_dump</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Power</span><span class="w"> </span><span class="n">Management</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Timer</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">None</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">Idle</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">       </span><span class="n">LightSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">        </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">          </span><span class="n">Standby</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">         </span><span class="n">Shutdown</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w"> </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w">   </span><span class="n">Normal</span><span class="w"> </span><span class="n">Speed</span><span class="w"></span>

<span class="o">|</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">timeout</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="o">|</span><span class="w">  </span><span class="mo">0001</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="p">[</span><span class="n">D</span><span class="o">/</span><span class="n">button</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">button1_irq</span><span class="o">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_SLEEP_MODE_LIGHT</span><span class="p">]</span><span class="w"></span>

<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="n">pm_dump</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Power</span><span class="w"> </span><span class="n">Management</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Timer</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">None</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">Idle</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">       </span><span class="n">LightSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">        </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">          </span><span class="n">Standby</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">         </span><span class="n">Shutdown</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w"> </span><span class="n">LightSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w">   </span><span class="n">Normal</span><span class="w"> </span><span class="n">Speed</span><span class="w"></span>

<span class="o">|</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">timeout</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="o">|</span><span class="w">  </span><span class="mo">0001</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="p">[</span><span class="n">D</span><span class="o">/</span><span class="n">button</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">button1_irq</span><span class="o">:</span><span class="w"> </span><span class="n">Release</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_SLEEP_MODE_LIGHT</span><span class="p">]</span><span class="w"></span>

<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="n">pm_dump</span><span class="w"></span>
<span class="o">|</span><span class="w"> </span><span class="n">Power</span><span class="w"> </span><span class="n">Management</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Counter</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Timer</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">None</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">             </span><span class="n">Idle</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">       </span><span class="n">LightSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">        </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">          </span><span class="n">Standby</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">|</span><span class="w">         </span><span class="n">Shutdown</span><span class="w"> </span><span class="n">Mode</span><span class="w"> </span><span class="o">|</span><span class="w">       </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w">     </span><span class="mi">0</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+-----------------------+---------+-------+</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">sleep</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w"> </span><span class="n">DeepSleep</span><span class="w"> </span><span class="n">Mode</span><span class="w"></span>
<span class="n">pm</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mode</span><span class="o">:</span><span class="w">   </span><span class="n">Normal</span><span class="w"> </span><span class="n">Speed</span><span class="w"></span>

<span class="o">|</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">busy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">|</span><span class="w">  </span><span class="n">timeout</span><span class="w">  </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="o">|</span><span class="w">  </span><span class="mo">0001</span><span class="w">  </span><span class="o">|</span><span class="w">  </span><span class="mi">0</span><span class="w">   </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mh">0x00000000</span><span class="w"> </span><span class="o">|</span><span class="w"></span>
<span class="o">+--------+------+------------+-----------+</span><span class="w"></span>
<span class="n">msh</span><span class="w"> </span><span class="o">&gt;</span><span class="p">[</span><span class="n">D</span><span class="o">/</span><span class="n">button</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">button1_irq</span><span class="o">:</span><span class="w"> </span><span class="n">Request</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PM_SLEEP_MODE_SHUTDOWN</span><span class="p">]</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="AN02_RT-Thread_PM2.0_nRF52xx_Power_and_Clock.html" class="btn btn-neutral float-left" title="7. 1 前言" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../../13_xiangxistu/index.html" class="btn btn-neutral float-right" title="NORDIC:xiangxistu" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2020, apache.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>