<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>17. STM32如何将文件放到内部flash里面 &mdash; bluetoothlover_wiki 0.0.1 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="ESP32" href="../../12_ESP32/index.html" />
    <link rel="prev" title="16. 如何在keil中STM32L496 跑simulator" href="../06_simular/01_keil_simulator.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> bluetoothlover_wiki
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">BLE knowledge:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ble/index.html">BLE STACK篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ble_profile/index.html">BLE PROFILE篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nordic/index.html">Nordic 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WB55/index.html">STM32WB55 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WIKI_FAQ/index.html">WIKI FAQ 篇</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">RTTHRED: RT-Thread</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01_introduce/01_intruduce.html">1. RTTHREAD贡献TODO目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_introduce/02_RTTHREAD_introduce.html">2. RT-THREAD —-国产开源之光</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_softpackage_list/01_software_package.html">3. RTTHREAD软件包目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_softpackage_list/02_software_introduce.html">4. RTTHREAD软件包目录自分类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_softpackage_list/03_sensor_list.html">5. RT-Thread 传感器软件包归类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_softpackage_list/04_rtthread_auto_update.html">6. RTTHREAD 软件包目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_softpackage_list/05_rtthread_bsp_board.html">7. RTTHREAD BSP board支持目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_softpackage_list/06_rtthread_softpackage_build_guide.html">8. 软件包制作小计</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_bsp_porting/01_rtthread_bsp_porting.html">9. RTTHREAD移植新的BSP开发板</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_bsp_porting/02_rtthread_bsp_porting_gpio.html">10. RTTHREAD移植BSP驱动 GPIO篇</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_bsp_porting/03_rtthread_bsp_porting_spi.html">11. RTTHREAD移植BSP驱动 SPI篇</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_bsp_porting/04_rtthread_bsp_porting_uart.html">12. rt-thread 移植BSP驱动 uart篇</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_docker/01_docker_images.html">13. 如何用docker来学习rtthread-qemu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_llsync/01_llsync_Environment.html">14. LLSYNC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_llsync/02_llsync_struct_code.html">15. LLSYNC 移植指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06_simular/01_keil_simulator.html">16. 如何在keil中STM32L496 跑simulator</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">17. STM32如何将文件放到内部flash里面</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">17.1. 背景介绍</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">17.2. 如何实现</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">第一步 使能文件系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">第二步 将需要存放的文件放到目录中去</a></li>
<li class="toctree-l4"><a class="reference internal" href="#xml">第三步配置XML文件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">第四步烧入文件</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">第五步烧入程序验证</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id7">17.3. 参考：</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../12_ESP32/index.html">ESP32</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DEBUG/index.html">EMBEDDED DEBUG 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_supperthomas/index.html">MASTER:supperthomas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_helloworldzlg/index.html">WB55:helloworldzlg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_Jackistang/index.html">WB55:Jackistang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_xupenghu/index.html">WB55:xupenghu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_dozingfiretruck/index.html">WB55:dozingfiretruck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05_luhuadong/index.html">WB55:luhuadong</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_answerinthewind/index.html">WB55:answerinthewind</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06_chenyingchun0312/index.html">NORDIC:chenyingchun0312</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../07_ylz0923/index.html">NORDIC:ylz0923</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../08_guohp1128/index.html">NORDIC:guohp1128</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10_jiy/index.html">NORDIC:jiy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../11_ForestRain/index.html">NORDIC:ForestRain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../13_xiangxistu/index.html">NORDIC:xiangxistu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../14_bobwenstudy/index.html">NORDIC:bobwenstudy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../16_ColeStudy/index.html">NORDIC:ColeStudy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">bluetoothlover_wiki</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">RTTHRED: RT-Thread</a></li>
      <li class="breadcrumb-item active"><span class="section-number">17. </span>STM32如何将文件放到内部flash里面</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/RTTHREAD/07_onchip/01_on_chip_file.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="stm32flash">
<h1><span class="section-number">17. </span>STM32如何将文件放到内部flash里面<a class="headerlink" href="#stm32flash" title="此标题的永久链接"></a></h1>
<section id="id1">
<h2><span class="section-number">17.1. </span>背景介绍<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h2>
<p>上一篇讲到如何将STM32的FLASH改成文件系统：</p>
<p><a class="reference external" href="https://club.rt-thread.org/ask/article/677bbf280fa0718f.html">如何不用外设在STM32片上FLASH做一个文件系统</a></p>
<p>https://club.rt-thread.org/ask/article/677bbf280fa0718f.html</p>
<p>后来用了一下，发现文件系统是有了，怎么往里面存文件呢？难道每个文件都一个一个打么？</p>
<p>很多小伙伴在用micropython或者动态模块加载的时候，经常要把文件放到文件系统里面，这个时候有的小伙伴想到了用Ymodem来进行数据传输，当然这是一种方法, 不过这种方法在多文件的时候，就比较麻烦了。今天给大家介绍一个比较方便的方法，当然这个也是参考的文档中心的文档，受其启发，来运用到STM32等其他MCU中去</p>
<p>该文档目标人群：</p>
<ul class="simple">
<li><p>希望比较方便的将文件烧入到片上或者片外FLASH上去的</p></li>
<li><p>希望能够将文件转化成bin烧入到flash中去</p></li>
</ul>
</section>
<section id="id2">
<h2><span class="section-number">17.2. </span>如何实现<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h2>
<p>那就要想办法如何将文件放到内部flash里面了。其实说出来很简单，只需要学会用一个exe文件即可。</p>
<section id="id3">
<h3>第一步 使能文件系统<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h3>
<p>首先第一步做的是，我们要按照之前的教程，先把STM32片上文件系统这个功能搞出来，参考之前的文章。这个是前提条件，</p>
</section>
<section id="id4">
<h3>第二步 将需要存放的文件放到目录中去<a class="headerlink" href="#id4" title="此标题的永久链接"></a></h3>
<p>这个软件参考附件</p>
<p><img alt="image-20220916235519563" src="../../_images/image-20220916235519563.png" /></p>
<p>可以在这里新建一个文件夹<code class="docutils literal notranslate"><span class="pre">root</span></code>  文件夹内放你需要的文件</p>
<p>这个时候双击一下<code class="docutils literal notranslate"><span class="pre">fatdisk.exe</span></code> 可以发现生成了一个<code class="docutils literal notranslate"><span class="pre">root.bin</span></code>文件，当然过程是这个过程，不过我们要根据不同的开发板来配置不同的xml文件。</p>
</section>
<section id="xml">
<h3>第三步配置XML文件<a class="headerlink" href="#xml" title="此标题的永久链接"></a></h3>
<p>打开<code class="docutils literal notranslate"><span class="pre">fatdisk.xml</span></code>文件，例子内容如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;fatdisk&gt;
   &lt;disk_size&gt;2048&lt;/disk_size&gt;
   &lt;sector_size&gt;4096&lt;/sector_size&gt;
   &lt;root_dir&gt;root&lt;/root_dir&gt;
   &lt;output&gt;root.bin&lt;/output&gt;
   &lt;strip&gt;1&lt;/strip&gt;
&lt;/fatdisk&gt;
</pre></div>
</div>
<ul class="simple">
<li><p>disk_size： 这个就是你最后想要生成的目标root.bin大小 单位是Kbytes.</p></li>
<li><p>sector_size: 这个是bin的扇区大小，这个要根据自己开发板来，根据上一篇文章，不同芯片的扇区不一样，这里STM32L496ZG 扇区是2KB。 这里填2048</p></li>
<li><p>root_dir就是指定要转换的目录名称</p></li>
<li><p>output就是要生成的bin的名称</p></li>
<li><p>strip： 这个如果是<code class="docutils literal notranslate"><span class="pre">1</span></code>就是代表会根据你文件夹里面的文件大小来进行缩减，就是你的文件夹多大最后生成的bin大小就是多大。如果是<code class="docutils literal notranslate"><span class="pre">0</span></code> 代表 后面空白数据填0xff, 填充到想要的大小。</p></li>
</ul>
<p>好根据STM32L496ZG-NUCLEO的开发板，我们得出下面的配置：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;fatdisk&gt;
   &lt;disk_size&gt;512&lt;/disk_size&gt;
   &lt;sector_size&gt;2048&lt;/sector_size&gt;
   &lt;root_dir&gt;sd&lt;/root_dir&gt;
   &lt;output&gt;sd.bin&lt;/output&gt;
   &lt;strip&gt;1&lt;/strip&gt;
&lt;/fatdisk&gt;
</pre></div>
</div>
<p>最大512KB，生成的sd.bin大小为212KB.</p>
<p>双击fatdisk.exe 生成sd.bin</p>
</section>
<section id="id5">
<h3>第四步烧入文件<a class="headerlink" href="#id5" title="此标题的永久链接"></a></h3>
<p>很多工具可以烧入BIN文件，根据调试器的不同：</p>
<ul class="simple">
<li><p>STLINK 和IAP可以选stm32cubeprogrammer</p></li>
<li><p>JLINK 可以选 jlink flash lite</p></li>
</ul>
<p>这里我用STLINK</p>
<p>打开stm32cubeprogrammer</p>
<p>先将芯片全部擦除（如果flash被写过的话，需要擦除才能烧入）</p>
<p><img alt="image-20220917001903420" src="../../_images/image-20220917001903420.png" /></p>
<p>然后烧入bin，这里的地址要根据你FAL里面填的地址来选，这边我用的是FLASH偏移是<code class="docutils literal notranslate"><span class="pre">0x00080000</span></code> ,STM32的起始地址是0x08000000， 所以文件系统偏移是<code class="docutils literal notranslate"><span class="pre">0x8080000</span></code></p>
<p><img alt="image-20220917001816276" src="../../_images/image-20220917001816276.png" /></p>
</section>
<section id="id6">
<h3>第五步烧入程序验证<a class="headerlink" href="#id6" title="此标题的永久链接"></a></h3>
<p>这一步就要烧入上一篇讲的带有flash功能的的程序了，这里注意烧入的时候，不要整个芯片擦除，要选择<code class="docutils literal notranslate"><span class="pre">sector</span> <span class="pre">erase</span></code> ,一般默认是部分擦除。因为整个擦除就把文件系统也擦掉了</p>
<p>烧入之后输入命令<code class="docutils literal notranslate"><span class="pre">ls</span></code></p>
<p><img alt="image-20220917002244490" src="../../_images/image-20220917002244490.png" /></p>
<p>可以看到文件系统在里面。</p>
</section>
</section>
<section id="id7">
<h2><span class="section-number">17.3. </span>参考：<a class="headerlink" href="#id7" title="此标题的永久链接"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://gitee.com/rtthread/docs-online/blob/master/rt-thread-version/rt-thread-standard/application-note/components/dlmodule/an0023-dlmodule.md"> 使用 QEMU 运行动态模块组件</a></p></li>
</ul>
<p>https://gitee.com/rtthread/docs-online/blob/master/rt-thread-version/rt-thread-standard/application-note/components/dlmodule/an0023-dlmodule.md</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="../06_simular/01_keil_simulator.html" class="btn btn-neutral float-left" title="16. 如何在keil中STM32L496 跑simulator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="../../12_ESP32/index.html" class="btn btn-neutral float-right" title="ESP32" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2020, apache.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>