<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>7. 1 前言 &mdash; bluetoothlover_wiki 0.0.1 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="10. 1 前言" href="AN03_RT-Thread_PM2.0_nRF52xx_PM_Driver.html" />
    <link rel="prev" title="2. 1 前言" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> bluetoothlover_wiki
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">BLE knowledge:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ble/index.html">BLE STACK篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ble_profile/index.html">BLE PROFILE篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nordic/index.html">Nordic 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WB55/index.html">STM32WB55 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WIKI_FAQ/index.html">WIKI FAQ 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RTTHREAD/index.html">RTTHRED: RT-Thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../12_ESP32/index.html">ESP32</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DEBUG/index.html">EMBEDDED DEBUG 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_supperthomas/index.html">MASTER:supperthomas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_helloworldzlg/index.html">WB55:helloworldzlg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_Jackistang/index.html">WB55:Jackistang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_xupenghu/index.html">WB55:xupenghu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_dozingfiretruck/index.html">WB55:dozingfiretruck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05_luhuadong/index.html">WB55:luhuadong</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_answerinthewind/index.html">WB55:answerinthewind</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06_chenyingchun0312/index.html">NORDIC:chenyingchun0312</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../07_ylz0923/index.html">NORDIC:ylz0923</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../08_guohp1128/index.html">NORDIC:guohp1128</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10_jiy/index.html">NORDIC:jiy</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">NORDIC:ForestRain</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01_introduce/01_intruduce.html">1. 简单自我介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html">2. 1 前言</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html#lorawan-class-a">3. 2 LoRaWAN Class A终端设备的低功耗设计</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html#id6">4. 3 LoRaWAN Class A终端设备的应用示例</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html#id10">5. 4 功耗测试结果</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html#id11">6. 5 参考</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7. 1 前言</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nrf52">8. 2 nRF52系列的低功耗相关硬件特性</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">8.1. 2.1 功耗模式</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#system-on-mode">2.1.1 SYSTEM ON mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#system-off-mode">2.1.2 SYSTEM OFF mode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nrf52xx">8.2. 2.2 nRF52xx系统时钟</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nrf52xxrtc-real-time-counter">8.3. 2.3 nRF52xx的低功耗定时器RTC(Real Time Counter)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pmu">8.4. 2.4 电源管理单元PMU</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ram">2.4.1 低功耗情况下的RAM控制</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id3">8.5. 2.5 nRF52xx功耗指标</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id4">9. 3 硬件电路的相关功耗设计</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN03_RT-Thread_PM2.0_nRF52xx_PM_Driver.html">10. 1 前言</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN03_RT-Thread_PM2.0_nRF52xx_PM_Driver.html#rt-thread-pm">11. 2 RT-Thread PM组件简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN03_RT-Thread_PM2.0_nRF52xx_PM_Driver.html#nrf52-pm">12. 3 nRF52系列 PM适配</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN03_RT-Thread_PM2.0_nRF52xx_PM_Driver.html#id11">13. 4 nRF52系列 PM使用</a></li>
<li class="toctree-l2"><a class="reference internal" href="AN03_RT-Thread_PM2.0_nRF52xx_PM_Driver.html#id14">14. 5 测试示例</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../13_xiangxistu/index.html">NORDIC:xiangxistu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../14_bobwenstudy/index.html">NORDIC:bobwenstudy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../16_ColeStudy/index.html">NORDIC:ColeStudy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">bluetoothlover_wiki</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">NORDIC:ForestRain</a></li>
      <li class="breadcrumb-item active"><span class="section-number">7. </span>1 前言</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/11_ForestRain/02_PM/AN02_RT-Thread_PM2.0_nRF52xx_Power_and_Clock.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1><span class="section-number">7. </span>1 前言<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h1>
<p>nRF52系列是一个面向低功耗蓝牙（BLE）的低功耗射频SoC，具有相对明确的应用场景，从nRF52用户功耗控制方式来看，nRF52芯片内部的功耗设计相对于STM32L等低功耗MCU来说，优化了电源功耗设计，简化了用户的功耗处理。
<img alt="nrfx-power" src="../../_images/001.png" />
nRF52832电源管理特点 &amp;  nRF52840电源管理特点</p>
</section>
<section id="nrf52">
<h1><span class="section-number">8. </span>2 nRF52系列的低功耗相关硬件特性<a class="headerlink" href="#nrf52" title="此标题的永久链接"></a></h1>
<section id="id2">
<h2><span class="section-number">8.1. </span>2.1 功耗模式<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h2>
<p>nRF52系列定义两种功耗模式：SYSTEM_ON 和 SYSTEM_OFF。其中SYSTEM ON又可分为两种电源子模式Constant Latency与Low Power
具体可参考nRF  Product Specification
,如“nRF52840_PS_v1.2 5.3.3 System OFF mode、5.3.4 System ON mode”。</p>
<p><img alt="power-mode.png" src="../../_images/013.png" /></p>
<section id="system-on-mode">
<h3>2.1.1 SYSTEM ON mode<a class="headerlink" href="#system-on-mode" title="此标题的永久链接"></a></h3>
<blockquote>
<div><p>nRF52840_PS_v1.2:
5.3.4 System ON mode
System ON is the default state after power-on reset. In System ON mode, all functional blocks such as the RESETREAS on page 74 provides information about the source causing the wakeup or reset.</p>
</div></blockquote>
<ul class="simple">
<li><p>SYSTEM ON分为两种电源子模式(sub-power mode)：</p>
<ul>
<li><p>Constant Latency</p>
<ul>
<li><p>在 Constant Latency子模式下，CPU唤醒延迟和PPI任务响应保持恒定并保持最低，代价是增加了功耗(通过强制在睡眠中打开一组基本资源来确保这一点)。</p></li>
<li><p>通过触发CONSTLAT任务选择Constant Latency子模式：</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="o">-</span> <span class="n">nrf_power_task_trigger</span><span class="p">(</span><span class="n">NRF_POWER_TASK_CONSTLAT</span><span class="p">)</span> <span class="n">或者</span>
     <span class="o">-</span> <span class="n">NRF_POWER</span><span class="o">-&gt;</span><span class="n">TASKS_CONSTLAT</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>Low-power</p>
<ul>
<li><p>在Low-power子模式下，自动电源管理系统确保选择最有效的供电选项，以节省能耗。具有尽可能低功耗，代价是CPU唤醒延迟和PPI任务响应的变化。</p></li>
<li><p>通过触发LOWPWR任务来选择Low-power子模式：</p></li>
</ul>
</li>
</ul>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="o">-</span> <span class="n">nrf_power_task_trigger</span><span class="p">(</span><span class="n">NRF_POWER_TASK_LOWPWR</span><span class="p">)</span> <span class="n">或者</span>
     <span class="o">-</span> <span class="n">NRF_POWER</span><span class="o">-&gt;</span><span class="n">TASKS_LOWPWR</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><p>在SYSTEM ON模式下，当CPU和所有外围设备处于空闲模式时，系统进入两种电源子模式之一（默认处于Low-power子模式）</p></li>
<li><p>SYSTEM ON模式下，RAM数据默认保持</p>
<ul>
<li><p>可以通过RETENTION寄存器设置为RAM不保持，以进一步降低功耗。</p></li>
</ul>
</li>
<li><p>外设中断唤醒</p>
<ul>
<li><p>系统在计时器、外围设备或pin中断时重新启动</p></li>
</ul>
</li>
</ul>
</section>
<section id="system-off-mode">
<h3>2.1.2 SYSTEM OFF mode<a class="headerlink" href="#system-off-mode" title="此标题的永久链接"></a></h3>
<blockquote>
<div><p>nRF52840_PS_v1.2:
5.3.3 System OFF mode
System OFF is the deepest power saving mode the system can enter. In this mode, the system’s core
functionality is powered down and all ongoing tasks are terminated.</p>
</div></blockquote>
<ul class="simple">
<li><p>SYSTEM OFF模式</p>
<ul>
<li><p>正如其名，相当于系统关机，类似STM32L系列的Standby模式</p></li>
<li><p>RAM等数据默认不保持</p>
<ul>
<li><p>可以通过RETENTION寄存器设置RAM保持</p></li>
</ul>
</li>
<li><p>系统进入System OFF后，可以通过以下方式进行唤醒
1. GPIO产生的DETECT信号
1. LPCOMP模块产生的ANADETECT信号
1. NFC模块产生的SENSE信号
1. VBUS
1. Reset</p></li>
<li><p>从 SYSTEM OFF 模式中唤醒程序会发生复位</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="nrf52xx">
<h2><span class="section-number">8.2. </span>2.2 nRF52xx系统时钟<a class="headerlink" href="#nrf52xx" title="此标题的永久链接"></a></h2>
<p><img alt="nrfx-clock.png" src="../../_images/023.png" /></p>
</section>
<section id="nrf52xxrtc-real-time-counter">
<h2><span class="section-number">8.3. </span>2.3 nRF52xx的低功耗定时器RTC(Real Time Counter)<a class="headerlink" href="#nrf52xxrtc-real-time-counter" title="此标题的永久链接"></a></h2>
<p>nrf52xx RTC(Real-Time Counter)外设，是低功耗实时计数器，即低功耗定时器，而不是实时时钟（Real Time Clock），即不具备万年历功能（因此对于需要掉电保存时间戳的应用，需要使用RAM保持的功耗模式）
<img alt="nrfx-rtc.png" src="../../_images/033.png" />
nRF52840片内集成了3个RTC.(RTC0、RTC1、RTC2)，都是24位计数器，并带有12位分频器，可产生TICK事件、OVRFLW(溢出)事件、COMPARE(比较)事件等。
nRF52840的RTC使用LFCLK(32.768kHz)作为时钟源。</p>
</section>
<section id="pmu">
<h2><span class="section-number">8.4. </span>2.4 电源管理单元PMU<a class="headerlink" href="#pmu" title="此标题的永久链接"></a></h2>
<p><img alt="nrfx-pmu.png" src="../../_images/043.png" />
nrf52xx通过 PMU( Power Management Unit)自动检测系统时钟与外设电源，实现低功耗管理。同时可以根据需要，设置SYSTEM ON与SYSTEM OFF两种模式,RAM是否保持( RAM retention)。</p>
<section id="ram">
<h3>2.4.1 低功耗情况下的RAM控制<a class="headerlink" href="#ram" title="此标题的永久链接"></a></h3>
<p>相对RAM不保持，RAM保持大致会增加1~1.5uA的功耗。
<img alt="nrfx-ram.png" src="../../_images/053.png" />
<img alt="nrfx-ram-power.png" src="../../_images/063.png" />
<img alt="nrfx-ram-section.png" src="../../_images/073.png" /></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">NRF_POWER</span><span class="o">-&gt;</span><span class="n">RAM</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">POWERSET</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">POWER_RAM_POWER_S0POWER_On</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">POWER_RAM_POWER_S0POWER_Pos</span><span class="p">)...</span><span class="w">  </span>
</pre></div>
</div>
</section>
</section>
<section id="id3">
<h2><span class="section-number">8.5. </span>2.5 nRF52xx功耗指标<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h2>
<p><img alt="nrfx-power-electrical.png" src="../../_images/083.png" /></p>
<ul class="simple">
<li><p>SYSTEM ON典型功耗：</p>
<ul>
<li><p>1.9uA (nRF52832 &#64; no RAM retention，RTC on, LFCLK on)</p></li>
<li><p>1.5uA(nRF52840 &#64; no RAM retention，RTC on, LFCLK on)</p></li>
<li><p>3.16uA(nRF52840 &#64; RAM retention，wake on RTC)</p></li>
</ul>
</li>
<li><p>STSTEM OFF典型功耗：</p>
<ul>
<li><p>0.3uA (nRF52832 &#64; no RAM retention， wake on reset)</p></li>
<li><p>0.4uA (nRF528340 &#64; no RAM retention， wake on reset)</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="id4">
<h1><span class="section-number">9. </span>3 硬件电路的相关功耗设计<a class="headerlink" href="#id4" title="此标题的永久链接"></a></h1>
<p>nRF52系统支持2种稳压器供电方式，这两种供电方式需要搭配不同的硬件电路配置。</p>
<ul class="simple">
<li><p>Low-dropout regulator (LDO)</p>
<ul>
<li><p>电压纹波更小，可以带来更好的射频性能，但是电源效率较低，不适合对功耗要求特别高的应用场合</p></li>
</ul>
</li>
<li><p>Buck regulator (DC/DC)</p>
<ul>
<li><p>DC-DC电源效率更高，具有更低的电流消耗，但 DC/DC本身的开关频率带来纹波较大，需要添加外部 LC 滤波器进行滤波</p></li>
</ul>
</li>
</ul>
<p>LDO 是系统默认的稳压器，DC/DC 稳压器可用作 LDO 稳压器的替代产品。
<img alt="nrfx-dc-dc.png" src="../../_images/093.png" />
nRF52840 DK 支持LDO与DC-DC两种电源供电方式
由于默认选择的是内部 LDO 稳压器，因此如果需要切换到使用内部 DC/DC 稳压器，还需要在软件上进行配置。
首先需要在主函数 main.c 中，初始化 softDevice 协议栈前，执行 NRF_POWER-&gt;DCDCEN=1。或者在初始化softDevice 协议栈后，执行 sd_power_dcdc_mode_set(1)。</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="AN01_RT-Thread_PM2.0_STM32L4_LoRaWAN_ClassA_Low_Power.html" class="btn btn-neutral float-left" title="2. 1 前言" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="AN03_RT-Thread_PM2.0_nRF52xx_PM_Driver.html" class="btn btn-neutral float-right" title="10. 1 前言" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2020, apache.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>