<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. 使用Eclipse CDT build tools之后导致makefile环境错乱的问题 &mdash; bluetoothlover_wiki 0.0.1 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="3. 从零到一搭建Kconfig配置系统" href="03_kconfig_system.html" />
    <link rel="prev" title="1. Scons环境搭建和编译原理概述及嵌入式开发常用模板" href="01_scons_introduce_and_common_templates_for_embedded_development.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> bluetoothlover_wiki
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">BLE knowledge:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ble/index.html">BLE STACK篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ble_profile/index.html">BLE PROFILE篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nordic/index.html">Nordic 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WB55/index.html">STM32WB55 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../WIKI_FAQ/index.html">WIKI FAQ 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RTTHREAD/index.html">RTTHRED: RT-Thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../12_ESP32/index.html">ESP32</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../DEBUG/index.html">EMBEDDED DEBUG 篇</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_supperthomas/index.html">MASTER:supperthomas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../01_helloworldzlg/index.html">WB55:helloworldzlg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../02_Jackistang/index.html">WB55:Jackistang</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../03_xupenghu/index.html">WB55:xupenghu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../04_dozingfiretruck/index.html">WB55:dozingfiretruck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../05_luhuadong/index.html">WB55:luhuadong</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../09_answerinthewind/index.html">WB55:answerinthewind</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../06_chenyingchun0312/index.html">NORDIC:chenyingchun0312</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../07_ylz0923/index.html">NORDIC:ylz0923</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../08_guohp1128/index.html">NORDIC:guohp1128</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../10_jiy/index.html">NORDIC:jiy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../11_ForestRain/index.html">NORDIC:ForestRain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../13_xiangxistu/index.html">NORDIC:xiangxistu</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">NORDIC:bobwenstudy</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01_introduce/index.html">01_introduce</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_zephyr_polling/index.html">02_zephyr_polling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_bluetooth/index.html">03_bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_markdown/index.html">04_markdown</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">05_compile</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01_scons_introduce_and_common_templates_for_embedded_development.html">1. Scons环境搭建和编译原理概述及嵌入式开发常用模板</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2. 使用Eclipse CDT build tools之后导致makefile环境错乱的问题</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">2.1. 问题说明及验证</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">2.2. 解决办法</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="03_kconfig_system.html">3. 从零到一搭建Kconfig配置系统</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../16_ColeStudy/index.html">NORDIC:ColeStudy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">bluetoothlover_wiki</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">NORDIC:bobwenstudy</a></li>
          <li class="breadcrumb-item"><a href="index.html">05_compile</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2. </span>使用Eclipse CDT build tools之后导致makefile环境错乱的问题</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/14_bobwenstudy/05_compile/02_makefile_shell_env.md.txt" rel="nofollow"> 查看页面源码</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="eclipse-cdt-build-toolsmakefile">
<h1><span class="section-number">2. </span>使用Eclipse CDT build tools之后导致makefile环境错乱的问题<a class="headerlink" href="#eclipse-cdt-build-toolsmakefile" title="此标题的永久链接"></a></h1>
<p>本人是windows开发环境，最近在搭建Eclipse CDT环境编译RiscV环境，然后使用了Eclipse的build tools环境，奇怪的是本地有很多makefile环境的c代码，会编译异常。</p>
<p>为了专门做了一些实验进行测试。</p>
<p>本例程所有相关代码在GitHub上，请自行下载。<a class="reference external" href="https://github.com/bobwenstudy/test_makefile_shell_env">bobwenstudy/test_makefile_shell_env (github.com)</a></p>
<section id="id1">
<h2><span class="section-number">2.1. </span>问题说明及验证<a class="headerlink" href="#id1" title="此标题的永久链接"></a></h2>
<section id="id2">
<h3>测试程序<a class="headerlink" href="#id2" title="此标题的永久链接"></a></h3>
<p>为了说明发生什么，特意写了一个测试程序，以便对此问题进行分析。</p>
<p><code class="docutils literal notranslate"><span class="pre">main.c</span></code></p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;hello, world</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Makefile</span></code>，通过<code class="docutils literal notranslate"><span class="pre">TEST_OS</span></code>来区分不同测试环境，第8行打印当前的<code class="docutils literal notranslate"><span class="pre">SHELL</span></code>和<code class="docutils literal notranslate"><span class="pre">ComSpec</span></code>配置。</p>
<p>通过修改<code class="docutils literal notranslate"><span class="pre">SHELL</span></code>配置，即可调整当前的执行环境。</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">OUTPUT_DIR</span> <span class="o">=</span> output/obj
<span class="nv">OBJECTS</span> <span class="o">=</span> <span class="k">$(</span>OUTPUT_DIR<span class="k">)</span>/main.o

<span class="nv">MKD</span> <span class="o">:=</span> mkdir
<span class="nv">RM</span> <span class="o">:=</span> del /q /s
<span class="nv">FIXPATH</span> <span class="o">=</span> <span class="k">$(</span>subst /,<span class="se">\,</span><span class="nv">$1</span><span class="k">)</span>

<span class="k">$(</span><span class="nv">warning</span> <span class="nv">SHELL</span>, <span class="k">$(</span><span class="nv">SHELL</span><span class="k">)</span>, <span class="k">$(</span><span class="nv">ComSpec</span><span class="k">))</span><span class="w"></span>

<span class="cp">ifeq ($(TEST_OS),1)</span>
<span class="w">	</span><span class="nv">MKD</span> <span class="o">:=</span> mkdir -p
	RM :<span class="o">=</span> rm -rf
	<span class="nv">FIXPATH</span> <span class="o">=</span> <span class="nv">$1</span>
<span class="cp">endif</span>

<span class="cp">ifeq ($(TEST_OS),2)</span>
<span class="cp">	ifdef ComSpec</span>
		WINCMD:<span class="o">=</span><span class="k">$(</span>ComSpec<span class="k">)</span>
<span class="cp">	endif</span>
<span class="cp">	ifdef COMSPEC</span>
		WINCMD:<span class="o">=</span><span class="k">$(</span>COMSPEC<span class="k">)</span>
<span class="cp">	endif</span>

	SHELL:<span class="o">=</span><span class="k">$(</span>WINCMD<span class="k">)</span>
	MKD :<span class="o">=</span> mkdir -p
	RM :<span class="o">=</span> rm -rf
	<span class="nv">FIXPATH</span> <span class="o">=</span> <span class="nv">$1</span>
<span class="cp">endif</span>


<span class="cp">ifeq ($(TEST_OS),3)</span>
<span class="cp">	ifdef ComSpec</span>
		WINCMD:<span class="o">=</span><span class="k">$(</span>ComSpec<span class="k">)</span>
<span class="cp">	endif</span>
<span class="cp">	ifdef COMSPEC</span>
		WINCMD:<span class="o">=</span><span class="k">$(</span>COMSPEC<span class="k">)</span>
<span class="cp">	endif</span>

	SHELL:<span class="o">=</span><span class="k">$(</span>WINCMD<span class="k">)</span>
	MKD :<span class="o">=</span> mkdir
	RM :<span class="o">=</span> del /q /s
	<span class="nv">FIXPATH</span> <span class="o">=</span> <span class="k">$(</span>subst /,<span class="se">\,</span><span class="nv">$1</span><span class="k">)</span>
<span class="cp">endif</span>

<span class="cp">ifeq ($(TEST_OS),4)</span>
<span class="cp">	ifdef ComSpec</span>
		WINCMD:<span class="o">=</span><span class="k">$(</span>ComSpec<span class="k">)</span>
<span class="cp">	endif</span>
<span class="cp">	ifdef COMSPEC</span>
		WINCMD:<span class="o">=</span><span class="k">$(</span>COMSPEC<span class="k">)</span>
<span class="cp">	endif</span>

	SHELL:<span class="o">=</span><span class="k">$(</span>WINCMD<span class="k">)</span>
	MKD :<span class="o">=</span> <span class="s2">&quot;mkdir&quot;</span> -p
	RM :<span class="o">=</span> rm -rf
	<span class="nv">FIXPATH</span> <span class="o">=</span> <span class="nv">$1</span>
<span class="cp">endif</span>

<span class="cp">ifeq ($(TEST_OS),5)</span>
<span class="cp">	ifdef ComSpec</span>
		WINCMD:<span class="o">=</span><span class="k">$(</span>ComSpec<span class="k">)</span>
<span class="cp">	endif</span>
<span class="cp">	ifdef COMSPEC</span>
		WINCMD:<span class="o">=</span><span class="k">$(</span>COMSPEC<span class="k">)</span>
<span class="cp">	endif</span>

	SHELL:<span class="o">=</span><span class="k">$(</span>WINCMD<span class="k">)</span>
	MKD :<span class="o">=</span> mkdir.exe -p
	RM :<span class="o">=</span> rm -rf
	<span class="nv">FIXPATH</span> <span class="o">=</span> <span class="nv">$1</span>
<span class="cp">endif</span>

<span class="nf">all</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OBJECTS</span><span class="k">)</span>
	gcc $^ -o <span class="k">$(</span>OUTPUT_DIR<span class="k">)</span>/main
<span class="nf">$(OBJECTS)</span><span class="o">:</span> <span class="k">$(</span><span class="nv">OUTPUT_DIR</span><span class="k">)</span>/%.<span class="n">o</span>: %.<span class="n">c</span>
	<span class="k">$(</span>MKD<span class="k">)</span> <span class="k">$(</span>call FIXPATH, <span class="k">$(</span>@D<span class="k">))</span>
	gcc -c -o <span class="nv">$@</span> $&lt;
<span class="nf">clean</span><span class="o">:</span>
	<span class="k">$(</span>RM<span class="k">)</span> <span class="k">$(</span>call FIXPATH, <span class="k">$(</span>OUTPUT_DIR<span class="k">))</span>
</pre></div>
</div>
</section>
<section id="cygwin">
<h3>干净环境下，使用cygwin编译<a class="headerlink" href="#cygwin" title="此标题的永久链接"></a></h3>
<section id="id3">
<h4>环境说明<a class="headerlink" href="#id3" title="此标题的永久链接"></a></h4>
<p>如下所示，环境只有一个mingw32的make环境。</p>
<p><img alt="image-20221005110846841" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221005110846841.png" /></p>
</section>
<section id="windowsmkdirdel">
<h4>使用windows下的mkdir和del操作<a class="headerlink" href="#windowsmkdirdel" title="此标题的永久链接"></a></h4>
<p>创建目录：<code class="docutils literal notranslate"><span class="pre">MKD</span> <span class="pre">:=</span> <span class="pre">mkdir</span></code></p>
<p>删除目录：<code class="docutils literal notranslate"><span class="pre">RM</span> <span class="pre">:=</span> <span class="pre">del</span> <span class="pre">/q</span> <span class="pre">/s</span></code></p>
<p>调整路径：<code class="docutils literal notranslate"><span class="pre">FIXPATH</span> <span class="pre">=</span> <span class="pre">$(subst</span> <span class="pre">/,\,$1)</span></code></p>
<p>进行<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>和<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code>操作，程序都按照预期进行。</p>
<p><img alt="image-20221005111002220" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221005111002220.png" /></p>
</section>
<section id="linuxmkdirrm">
<h4>使用linux下的mkdir和rm操作<a class="headerlink" href="#linuxmkdirrm" title="此标题的永久链接"></a></h4>
<p>创建目录：<code class="docutils literal notranslate"><span class="pre">MKD</span> <span class="pre">:=</span> <span class="pre">mkdir</span> <span class="pre">-p</span></code></p>
<p>删除目录：<code class="docutils literal notranslate"><span class="pre">RM</span> <span class="pre">:=</span> <span class="pre">rm</span> <span class="pre">-rf</span></code></p>
<p>调整路径：<code class="docutils literal notranslate"><span class="pre">FIXPATH</span> <span class="pre">=</span> <span class="pre">$1</span></code></p>
<p>进行<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=1</span> <span class="pre">all</span></code>和<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=1</span> <span class="pre">clean</span></code>操作，程序都执行失败。mkdir失败是因为路径分隔符不对。rm是没有这个执行文件。</p>
<p><img alt="image-20221005111105536" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221005111105536.png" /></p>
</section>
<section id="id4">
<h4>总结<a class="headerlink" href="#id4" title="此标题的永久链接"></a></h4>
<p>这些行为都是符合我预期的，一般我会通过<code class="docutils literal notranslate"><span class="pre">OS</span></code>判断来区分当前的系统，而后选择不同的执行命令。</p>
<p><img alt="image-20220927171410992" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20220927171410992.png" /></p>
</section>
</section>
<section id="cdt">
<h3>使用CDT工具链进行编译<a class="headerlink" href="#cdt" title="此标题的永久链接"></a></h3>
<section id="id5">
<h4>环境搭建<a class="headerlink" href="#id5" title="此标题的永久链接"></a></h4>
<p>到CDT的官网<a class="reference external" href="https://eclipse-embed-cdt.github.io/">Eclipse Embedded CDT | Eclipse Embedded CDT (C/C++ Development Tools)™ (eclipse-embed-cdt.github.io)</a>，可以看到其有推荐windows的build tool环境：<a class="reference external" href="https://xpack.github.io/windows-build-tools/">The xPack Windows Build Tools | The xPack Build Framework</a></p>
<p>直接下载就行，本地已经下载好了一份，放在路径下<code class="docutils literal notranslate"><span class="pre">build-tools</span></code>。</p>
</section>
<section id="id6">
<h4>环境说明<a class="headerlink" href="#id6" title="此标题的永久链接"></a></h4>
<p>为了方便复现，执行setup.bat脚本来进行环境配置。成功配置后，where make可以看出环境是ok的。</p>
<p><img alt="image-20221005111349315" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221005111349315.png" /></p>
</section>
<section id="id7">
<h4>使用windows下的mkdir和del操作<a class="headerlink" href="#id7" title="此标题的永久链接"></a></h4>
<p>创建目录：<code class="docutils literal notranslate"><span class="pre">MKD</span> <span class="pre">:=</span> <span class="pre">mkdir</span></code></p>
<p>删除目录：<code class="docutils literal notranslate"><span class="pre">RM</span> <span class="pre">:=</span> <span class="pre">del</span> <span class="pre">/q</span> <span class="pre">/s</span></code></p>
<p>调整路径：<code class="docutils literal notranslate"><span class="pre">FIXPATH</span> <span class="pre">=</span> <span class="pre">$(subst</span> <span class="pre">/,\,$1)</span></code></p>
<p>进行<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>和<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code>操作，程序都报错了，可以看到这时make的<code class="docutils literal notranslate"><span class="pre">SHELL</span></code>已经指向了build-tools目录下的sh.exe，这时候程序已经工作在linux环境下了，不能再使用windows的mkdir/del行为了。</p>
<p><img alt="image-20221005112420957" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221005112420957.png" /></p>
</section>
<section id="id8">
<h4>使用linux下的mkdir和rm操作<a class="headerlink" href="#id8" title="此标题的永久链接"></a></h4>
<p>创建目录：<code class="docutils literal notranslate"><span class="pre">MKD</span> <span class="pre">:=</span> <span class="pre">mkdir</span> <span class="pre">-p</span></code></p>
<p>删除目录：<code class="docutils literal notranslate"><span class="pre">RM</span> <span class="pre">:=</span> <span class="pre">rm</span> <span class="pre">-rf</span></code></p>
<p>调整路径：<code class="docutils literal notranslate"><span class="pre">FIXPATH</span> <span class="pre">=</span> <span class="pre">$1</span></code></p>
<p>进行<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=1</span> <span class="pre">all</span></code>和<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=1</span> <span class="pre">clean</span></code>操作，程序都执行成功了。整个环境就是linux的环境了。</p>
<p><img alt="image-20221005112638507" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221005112638507.png" /></p>
</section>
<section id="linuxmkdirrm-shellwindows">
<h4>使用linux下的mkdir和rm操作+SHELL指定为windows<a class="headerlink" href="#linuxmkdirrm-shellwindows" title="此标题的永久链接"></a></h4>
<p>创建目录：<code class="docutils literal notranslate"><span class="pre">MKD</span> <span class="pre">:=</span> <span class="pre">mkdir</span> <span class="pre">-p</span></code></p>
<p>删除目录：<code class="docutils literal notranslate"><span class="pre">RM</span> <span class="pre">:=</span> <span class="pre">rm</span> <span class="pre">-rf</span></code></p>
<p>调整路径：<code class="docutils literal notranslate"><span class="pre">FIXPATH</span> <span class="pre">=</span> <span class="pre">$1</span></code></p>
<p>进行<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=2</span> <span class="pre">all</span></code>和<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=2</span> <span class="pre">clean</span></code>操作，<code class="docutils literal notranslate"><span class="pre">mkdir</span></code>执行失败了，<strong>rm确没报错</strong>。因为这时候<code class="docutils literal notranslate"><span class="pre">rm.exe</span></code>已经在<code class="docutils literal notranslate"><span class="pre">build-tools</span></code>有提供了，那为什么这时候没有使用<code class="docutils literal notranslate"><span class="pre">build-tools</span></code>目录下的<code class="docutils literal notranslate"><span class="pre">mkdir.exe</span></code>呢？</p>
<p><img alt="image-20221005112759518" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221005112759518.png" /></p>
</section>
<section id="windowsmkdirdel-shellwindows">
<h4>使用windows下的mkdir和del操作+SHELL指定为windows<a class="headerlink" href="#windowsmkdirdel-shellwindows" title="此标题的永久链接"></a></h4>
<p>创建目录：<code class="docutils literal notranslate"><span class="pre">MKD</span> <span class="pre">:=</span> <span class="pre">mkdir</span></code></p>
<p>删除目录：<code class="docutils literal notranslate"><span class="pre">RM</span> <span class="pre">:=</span> <span class="pre">del</span> <span class="pre">/q</span> <span class="pre">/s</span></code></p>
<p>调整路径：<code class="docutils literal notranslate"><span class="pre">FIXPATH</span> <span class="pre">=</span> <span class="pre">$(subst</span> <span class="pre">/,\,$1)</span></code></p>
<p>进行<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=3</span> <span class="pre">all</span></code>和<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=3</span> <span class="pre">clean</span></code>操作，这时候又都执行成功了。</p>
<p><img alt="image-20221005113203635" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221005113203635.png" /></p>
</section>
<section id="id9">
<h4>总结<a class="headerlink" href="#id9" title="此标题的永久链接"></a></h4>
<p>从上面的测试程序可以看到一个情况，当使用CDT的<code class="docutils literal notranslate"><span class="pre">build-tools</span></code>时，程序make行为不确定了。测试程序中，我们是通过<code class="docutils literal notranslate"><span class="pre">setup.bat</span></code>来配置PATH参数，只影响当前编译环境，但是通常我们会直接配置系统的环境变量<code class="docutils literal notranslate"><span class="pre">PATH</span></code>。这时系统make环境可能就出现错乱了，本人就遇到了这个问题。</p>
</section>
</section>
</section>
<section id="id10">
<h2><span class="section-number">2.2. </span>解决办法<a class="headerlink" href="#id10" title="此标题的永久链接"></a></h2>
<p>在使用CDT工具链情况下，SHELL指定为windows时，由于这时候mkdir和windows环境的命令相同（<a class="reference external" href="https://learn.microsoft.com/zh-cn/windows-server/administration/windows-commands/windows-commands">Windows 命令 | Microsoft Learn</a>），windows命令的优先级更高。</p>
<section id="id11">
<h3>使用linux下的mkdir和rm操作+SHELL指定为windows+双引号<a class="headerlink" href="#id11" title="此标题的永久链接"></a></h3>
<p>通过<code class="docutils literal notranslate"><span class="pre">双引号&quot;&quot;</span></code>强制指定不使用Windows的命令，而是用build-tools中提供的mkdir.exe。由于rm没冲突，所以不需要加调整。</p>
<p>创建目录：<code class="docutils literal notranslate"><span class="pre">MKD</span> <span class="pre">:=</span> <span class="pre">&quot;mkdir&quot;</span> <span class="pre">-p</span></code></p>
<p>删除目录：<code class="docutils literal notranslate"><span class="pre">RM</span> <span class="pre">:=</span> <span class="pre">rm</span> <span class="pre">-rf</span></code></p>
<p>调整路径：<code class="docutils literal notranslate"><span class="pre">FIXPATH</span> <span class="pre">=</span> <span class="pre">$1</span></code></p>
<p>进行<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=4</span> <span class="pre">all</span></code>和<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=4</span> <span class="pre">clean</span></code>操作，<code class="docutils literal notranslate"><span class="pre">mkdir</span></code>和<code class="docutils literal notranslate"><span class="pre">rm</span></code>都能正常执行了。</p>
<p><img alt="image-20221006123002833" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221006123002833.png" /></p>
</section>
<section id="linuxmkdirrm-shellwindows-exe">
<h3>使用linux下的mkdir和rm操作+SHELL指定为windows+exe指定<a class="headerlink" href="#linuxmkdirrm-shellwindows-exe" title="此标题的永久链接"></a></h3>
<p>通过<code class="docutils literal notranslate"><span class="pre">.exe</span></code>强制指定不使用Windows的命令，而是用build-tools中提供的mkdir.exe。由于rm没冲突，所以不需要加调整。</p>
<p>创建目录：<code class="docutils literal notranslate"><span class="pre">MKD</span> <span class="pre">:=</span> <span class="pre">mkdir.exe</span> <span class="pre">-p</span></code></p>
<p>删除目录：<code class="docutils literal notranslate"><span class="pre">RM</span> <span class="pre">:=</span> <span class="pre">rm</span> <span class="pre">-rf</span></code></p>
<p>调整路径：<code class="docutils literal notranslate"><span class="pre">FIXPATH</span> <span class="pre">=</span> <span class="pre">$1</span></code></p>
<p>进行<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=5</span> <span class="pre">all</span></code>和<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">TEST_OS=5</span> <span class="pre">clean</span></code>操作，<code class="docutils literal notranslate"><span class="pre">mkdir</span></code>和<code class="docutils literal notranslate"><span class="pre">rm</span></code>都能正常执行了。</p>
<p><img alt="image-20221006123233670" src="https://markdown-1306347444.cos.ap-shanghai.myqcloud.com/img/image-20221006123233670.png" /></p>
</section>
<section id="id12">
<h3>总结<a class="headerlink" href="#id12" title="此标题的永久链接"></a></h3>
<p>本质CDT提供的是linux下的build环境，当将CDT的build-tools作为默认编译环境时，就会出现make操作执行时，认为是linux环境，当想进行mkdir操作是，会和windows命令冲突，这时候如果系统中还有别的工程时，就会有冲突了。</p>
<p>只要理解本质原因，就可以根据各种情况针对性处理了。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="页脚">
        <a href="01_scons_introduce_and_common_templates_for_embedded_development.html" class="btn btn-neutral float-left" title="1. Scons环境搭建和编译原理概述及嵌入式开发常用模板" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> 上一页</a>
        <a href="03_kconfig_system.html" class="btn btn-neutral float-right" title="3. 从零到一搭建Kconfig配置系统" accesskey="n" rel="next">下一页 <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2020, apache.</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>